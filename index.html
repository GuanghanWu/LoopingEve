<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>LoopingEve - 循环冒险</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>⚔️</text></svg>" type="image/svg+xml">
    <link rel="icon" href="favicon.ico" sizes="32x32" type="image/x-icon">
    <link rel="stylesheet" href="style.css?v=10">
</head>
<body>
    <div class="game-container">
        <header class="game-header">
            <h1>⚔️ LoopingEve</h1>
            <div class="header-right">
                <div class="header-gold">
                    <span class="label">💰</span>
                    <span id="playerGold">0</span>
                </div>
                <button class="btn btn-settings" id="btnSettings">⚙️</button>
            </div>
        </header>
        
        <div class="status-bar">
            <div class="status-item atk">
                <div class="label">⚔️</div>
                <div class="value" id="playerATK">12</div>
            </div>
            <div class="status-item def">
                <div class="label">🛡️</div>
                <div class="value" id="playerDEF">6</div>
            </div>
            <div class="bar-row">
                <span class="bar-icon hp-icon">❤️</span>
                <div class="bar-track hp-track">
                    <div class="bar-fill hp-fill" id="hpFill" style="width: 100%"></div>
                    <span class="bar-value hp-value"><span id="playerHP">120</span>/<span id="playerMaxHP">120</span></span>
                </div>
            </div>
            <div class="bar-row">
                <span class="bar-icon exp-icon">⭐</span>
                <div class="bar-track exp-track">
                    <div class="bar-fill exp-fill" id="expBar" style="width: 0%"></div>
                    <span class="bar-value exp-value">Lv.<span id="playerLevel">1</span> <span id="playerEXP">0</span>/<span id="playerMaxEXP">50</span></span>
                </div>
            </div>
        </div>
        
        <main class="battle-area area-mist">
            <div class="equipment-row">
                <div class="equip-slot">
                    <span class="icon">🗡️</span>
                    <span class="name" id="playerWeapon">无</span>
                </div>
                <div class="equip-slot">
                    <span class="icon">🛡️</span>
                    <span class="name" id="playerArmor">无</span>
                </div>
            </div>
            
            <div class="monster-area">
                <div class="floor-section">
                    <div class="floor-info">
                        <span class="floor-label">第</span>
                        <span id="currentFloor">1</span>
                        <span class="floor-label">层</span>
                    </div>
                    <div class="kill-progress" id="killProgress">-/-</div>
                </div>
                <div class="monster-card">
                    <div class="monster-avatar" id="monsterAvatar">❓</div>
                    <div class="monster-name" id="monsterName">等待探索...</div>
                    <div class="monster-hp-bar">
                        <div class="monster-hp-fill" id="monsterHPFill" style="width: 100%"></div>
                    </div>
                    <div class="monster-hp-text"><span id="monsterHP">0</span>/<span id="monsterMaxHP">0</span></div>
                </div>
            </div>
            
            <div class="battle-log" id="battleLog">
                <p>游戏加载中...</p>
            </div>
        </main>
        
        <div class="floating-actions">
            <div class="next-floor-wrapper">
                <button class="btn btn-next" id="btnNextFloor" disabled>⬆️ 下一层</button>
                <label class="auto-next">
                    <input type="checkbox" id="autoNext">
                    <span>自动下层</span>
                </label>
            </div>
            <div class="combat-buttons">
                <button class="btn btn-attack" id="btnAttack" disabled>⚔️ 攻击</button>
                <button class="btn btn-skill" id="btnSkill" disabled>
                    <span class="skill-content">✨ <span id="currentSkillName">强力打击</span></span>
                    <span class="skill-toggle" id="btnSkillToggle" title="切换技能">⇄</span>
                </button>
                <button class="btn btn-item" id="btnItem" disabled>🧪 血瓶</button>
            </div>
        </div>
        
        <div class="bottom-fixed-nav">
            <button class="nav-btn active" id="navBattle">⚔️ 战斗</button>
            <button class="nav-btn" id="navInventory">🎒 背包</button>
            <button class="nav-btn" id="navTalent">✨ 天赋</button>
            <button class="nav-btn" id="navForge">🔨 锻造</button>
        </div>
    </div>
    
    <div class="modal" id="settingsModal">
        <div class="modal-content settings-modal">
            <h2>⚙️ 设置</h2>
            <div class="settings-list">
                <button class="btn btn-danger settings-btn" id="btnClear2">🗑️ 重置游戏</button>
            </div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('settingsModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="confirmModal">
        <div class="modal-content confirm-modal">
            <h2>⚠️ 确认操作</h2>
            <p id="confirmMessage" style="margin: 20px 0;">确定要执行此操作吗？</p>
            <div class="confirm-buttons">
                <button class="btn btn-cancel" onclick="game.closeConfirm()">取消</button>
                <button class="btn btn-danger" id="confirmBtn">确定</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="itemModal">
        <div class="modal-content item-use-modal">
            <h2>🧪 使用道具</h2>
            <div id="itemList"></div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('itemModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="skillModal">
        <div class="modal-content skill-modal">
            <h2>✨ 技能</h2>
            <div id="skillMenuContent"></div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('skillModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="skillManageModal">
        <div class="modal-content skill-manage-modal">
            <h2>⚙️ 技能管理</h2>
            <div id="skillManageContent"></div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('skillManageModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="inventoryModal">
        <div class="modal-content inventory-modal">
            <h2>🎒 背包</h2>
            <div id="inventoryContent"></div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('inventoryModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="forgeModal">
        <div class="modal-content forge-modal">
            <h2>🔨 锻造</h2>
            <div id="forgeContent"></div>
            <button class="btn btn-primary close-btn" onclick="document.getElementById('forgeModal').classList.remove('show')">关闭</button>
        </div>
    </div>
    
    <div class="modal" id="levelUpModal">
        <div class="modal-content">
            <h2>🎉 升级！</h2>
            <p style="font-size: 1.2rem; margin: 15px 0;">升到 <strong style="color: var(--accent);" id="newLevel">2</strong> 级</p>
            <div class="level-up-stats">
                <p>❤️ 生命 <span id="levelUpHP">+15</span></p>
                <p>⚔️ 攻击 <span id="levelUpATK">+3</span></p>
                <p>🛡️ 防御 <span id="levelUpDEF">+2</span></p>
            </div>
            <button class="btn btn-primary" onclick="game.closeLevelUpModal()">继续冒险</button>
        </div>
    </div>
    
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2>💀 战败</h2>
            <p style="margin: 15px 0;">你在第 <strong style="color: var(--danger);" id="finalFloor">1</strong> 层倒下了</p>
            <p>最终等级: <strong style="color: var(--accent);" id="finalLevel">1</strong></p>
            <p>获得金币: <strong style="color: var(--accent);" id="finalGold">0</strong></p>
            <button class="btn btn-primary" style="margin-top: 15px;" onclick="game.restart()">重新开始</button>
        </div>
    </div>
    
    <div class="modal" id="storyModal">
        <div class="modal-content story-modal">
            <div class="story-header">
                <span class="story-icon" id="loreIcon">🌫️</span>
                <h2 id="loreTitle">迷雾入口 - 第1层</h2>
            </div>
            <p class="story-description" id="loreDescription">古老地牢的入口...</p>
            <p class="story-content" id="loreContent">传说这里曾是...</p>
            <button class="btn btn-primary" onclick="game.closeStoryModal()">继续探索</button>
        </div>
    </div>
    
    <div class="modal" id="npcModal">
        <div class="modal-content npc-modal">
            <div class="npc-header">
                <span class="npc-avatar" id="npcAvatar">🧙</span>
                <h2 id="npcName">神秘商人</h2>
            </div>
            <p class="npc-greeting" id="npcGreeting">哼哼...</p>
            <p class="npc-dialogue" id="npcDialogue">这些物品都是...</p>
            <div id="npcActions"></div>
        </div>
    </div>
    
    <div class="modal" id="eventModal">
        <div class="modal-content event-modal">
            <div class="event-header">
                <span class="event-icon" id="eventIcon">📜</span>
                <h2 id="eventName">古老碑文</h2>
            </div>
            <p class="event-description" id="eventDescription">你发现了...</p>
            <div class="event-result" id="eventResult"></div>
            <button class="btn btn-primary" onclick="game.closeEventModal()">继续</button>
        </div>
    </div>
    
    <script src="MainGame/js/UIManager.js?v=4"></script>
    <script src="MainGame/js/PlayerManager.js?v=1"></script>
    <script src="MainGame/js/InventoryManager.js?v=1"></script>
    <script src="MainGame/js/StoryManager.js?v=1"></script>
    <script src="MainGame/js/BattleManager.js?v=4"></script>
    <script src="MainGame/js/Game.js?v=11"></script>
    
    <script>
    setupModals();
    
    // 底部固定导航栏切换功能
    const floatingActions = document.querySelector('.floating-actions');
    const navButtons = document.querySelectorAll('.nav-btn');
    const btnSkillToggle = document.getElementById('btnSkillToggle');
    const btnSkill = document.getElementById('btnSkill');
    
    // 为技能切换按钮添加点击事件
    if (btnSkillToggle) {
        btnSkillToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            game.openSkillMenu();
        });
    }
    
    // 为技能按钮添加点击事件（排除切换按钮区域）
    if (btnSkill) {
        btnSkill.addEventListener('click', function(e) {
            if (e.target !== btnSkillToggle && !btnSkillToggle.contains(e.target)) {
                game.battle.useSelectedSkill();
            }
        });
    }
    
    navButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            // 移除所有nav-btn的active类
            navButtons.forEach(b => b.classList.remove('active'));
            // 添加当前nav-btn的active类
            this.classList.add('active');
            
            // 根据选中的Tab显示/隐藏悬浮按钮
            const tabId = this.id;
            if (tabId === 'navBattle') {
                floatingActions.style.display = 'flex';
            } else {
                floatingActions.style.display = 'none';
            }
            
            // 处理其他Tab的功能
            if (tabId === 'navInventory') {
                game.openInventory();
            } else if (tabId === 'navTalent') {
                // 这里将来会打开天赋页面，现在暂时打开技能页面
                game.openSkillMenu();
            } else if (tabId === 'navForge') {
                game.openForge();
            }
        });
    });
    </script>
</body>
</html>
