{"version":3,"file":"index.wDCBung2.js","sources":["../../src/utils/dom.ts","../../src/managers/PlayerManager.ts","../../src/managers/InventoryManager.ts","../../src/managers/StoryManager.ts","../../src/managers/BattleManager.ts","../../src/managers/UIManager.ts","../../src/Game.ts","../../src/main.ts"],"sourcesContent":["export const $ = <T extends HTMLElement = HTMLElement>(id: string): T | null => document.getElementById(id) as T | null;\n","import type { Game } from '../Game';\nimport type { Skill } from '../types';\n\nexport class PlayerManager {\n  private game: Game;\n\n  constructor(game: Game) {\n    this.game = game;\n  }\n\n  init(): void {\n    this.game.player = {\n      ...this.game.config.player.initial,\n      weapon: null,\n      armor: null,\n      learnedSkills: ['powerStrike'],\n      equippedSkills: ['powerStrike'],\n      selectedSkill: 'powerStrike',\n      skillCooldowns: {},\n      attackCount: 0\n    };\n  }\n\n  getTotalAtk(): number {\n    let atk = this.game.player.atk;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon) atk += weapon.atk;\n    }\n    return atk;\n  }\n\n  getTotalDef(): number {\n    let def = this.game.player.def;\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor) def += armor.def;\n    }\n    return def;\n  }\n\n  getTotalComboRate(): number {\n    let rate = this.game.player.comboRate;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.comboRate) rate += weapon.comboRate;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.comboRate) rate += armor.comboRate;\n    }\n    return rate;\n  }\n\n  getTotalComboDamage(): number {\n    let dmg = this.game.player.comboDamage;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.comboDamage) dmg += weapon.comboDamage;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.comboDamage) dmg += armor.comboDamage;\n    }\n    return dmg;\n  }\n\n  getTotalCounterRate(): number {\n    let rate = this.game.player.counterRate;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.counterRate) rate += weapon.counterRate;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.counterRate) rate += armor.counterRate;\n    }\n    return rate;\n  }\n\n  getTotalCounterDamage(): number {\n    let dmg = this.game.player.counterDamage;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.counterDamage) dmg += weapon.counterDamage;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.counterDamage) dmg += armor.counterDamage;\n    }\n    return dmg;\n  }\n\n  getTotalBlockRate(): number {\n    let rate = this.game.player.blockRate;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.blockRate) rate += weapon.blockRate;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.blockRate) rate += armor.blockRate;\n    }\n    return rate;\n  }\n\n  getTotalBlockReduction(): number {\n    let reduction = this.game.player.blockReduction;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.blockReduction) reduction += weapon.blockReduction;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.blockReduction) reduction += armor.blockReduction;\n    }\n    return Math.min(reduction, 0.8);\n  }\n\n  getTotalMaxShield(): number {\n    let shield = this.game.player.maxShield;\n    if (this.game.player.weapon) {\n      const weapon = this.game.config.equipment.weapons.find(w => w.id === this.game.player.weapon);\n      if (weapon?.maxShield) shield += weapon.maxShield;\n    }\n    if (this.game.player.armor) {\n      const armor = this.game.config.equipment.armors.find(a => a.id === this.game.player.armor);\n      if (armor?.maxShield) shield += armor.maxShield;\n    }\n    return shield;\n  }\n\n  getUnlockedSkillSlots(): number {\n    const level = this.game.player.level;\n    return this.game.config.player.skillSlots.filter(lvl => level >= lvl).length;\n  }\n\n  levelUp(): void {\n    const cfg = this.game.config.player.levelUp;\n    while (this.game.player.exp >= this.game.player.maxEXP) {\n      this.game.player.exp -= this.game.player.maxEXP;\n      this.game.player.level++;\n      this.game.player.maxHP += cfg.hp;\n      this.game.player.hp = Math.min(this.game.player.hp + cfg.hp, this.game.player.maxHP);\n      this.game.player.atk += cfg.atk;\n      this.game.player.def += cfg.def;\n      this.game.player.maxEXP = Math.floor(this.game.player.maxEXP * cfg.expMultiplier);\n      this.game.ui.showLevelUp(this.game.player.level, cfg);\n    }\n  }\n\n  equipSkill(skillId: string): string | null {\n    const equipped = this.game.player.equippedSkills;\n    if (equipped.includes(skillId)) return null;\n    const unlocked = this.getUnlockedSkillSlots();\n    let replacedSkill: string | null = null;\n    if (equipped.length >= unlocked) {\n      if (equipped[0]) {\n        const oldSkill = this.game.config.skills.find(s => s.id === equipped[0]);\n        replacedSkill = oldSkill ? oldSkill.name : equipped[0];\n        equipped.shift();\n      }\n    }\n    equipped.push(skillId);\n    return replacedSkill;\n  }\n\n  unequipSkill(index: number): boolean {\n    if (index < 0 || index >= this.game.player.equippedSkills.length) return false;\n    this.game.player.equippedSkills.splice(index, 1);\n    return true;\n  }\n\n  checkSkillUnlock(): void {\n    const level = this.game.player.level;\n    this.game.config.skills.forEach((skill: Skill) => {\n      if (this.game.player.learnedSkills.includes(skill.id)) return;\n      if (skill.unlock === 'default' || skill.unlock === 'scroll') return;\n      const levelMatch = skill.unlock.match(/^level(\\d+)$/);\n      if (levelMatch && level >= parseInt(levelMatch[1])) {\n        this.game.player.learnedSkills.push(skill.id);\n        this.game.ui.log(`âœ¨ å­¦ä¼šæ–°æŠ€èƒ½ï¼š${skill.icon} ${skill.name}ï¼`);\n        if (!this.game.player.equippedSkills.includes(skill.id)) {\n          const slots = this.getUnlockedSkillSlots();\n          if (this.game.player.equippedSkills.length < slots) {\n            this.game.player.equippedSkills.push(skill.id);\n          }\n        }\n      }\n    });\n  }\n\n  reduceCooldowns(): void {\n    Object.keys(this.game.player.skillCooldowns).forEach((key: string) => {\n      if (this.game.player.skillCooldowns[key] > 0) {\n        this.game.player.skillCooldowns[key]--;\n      }\n    });\n    this.game.ui.updateSkillName();\n  }\n\n  migrateOldData(): void {\n    if (!this.game.player.learnedSkills) {\n      this.game.player.learnedSkills = ['powerStrike'];\n      this.game.player.equippedSkills = ['powerStrike'];\n      this.game.player.skillCooldowns = {};\n    }\n    if (!this.game.player.selectedSkill) {\n      this.game.player.selectedSkill = this.game.player.learnedSkills[0] || 'powerStrike';\n    }\n    if (!this.game.player.weapon) this.game.player.weapon = null;\n    if (!this.game.player.armor) this.game.player.armor = null;\n    \n    if (this.game.player.comboRate === undefined) {\n      this.game.player.comboRate = 0;\n      this.game.player.comboDamage = 0.5;\n      this.game.player.counterRate = 0;\n      this.game.player.counterDamage = 0.5;\n      this.game.player.blockRate = 0;\n      this.game.player.blockReduction = 0.3;\n      this.game.player.shield = 0;\n      this.game.player.maxShield = 0;\n    }\n  }\n\n  unequipItem(category: 'weapons' | 'armors'): void {\n    if (category === 'weapons') {\n      this.game.player.weapon = null;\n    } else {\n      this.game.player.armor = null;\n    }\n  }\n}\n","import type { Game } from '../Game';\nimport type { ConsumableItem, ScrollItem, Weapon, Armor } from '../types';\n\nexport class InventoryManager {\n  private game: Game;\n\n  constructor(game: Game) {\n    this.game = game;\n  }\n\n  init(): void {\n    this.game.inventory = {\n      slots: this.game.config.inventory.initialSlots,\n      items: []\n    };\n  }\n\n  addItem(itemId: string, count: number = 1): void {\n    const allItems = [\n      ...this.game.config.items.consumables,\n      ...this.game.config.items.materials,\n      ...this.game.config.items.scrolls\n    ];\n    const itemDef = allItems.find(i => i.id === itemId);\n    if (!itemDef) return;\n    const existing = this.game.inventory.items.find(i => i.id === itemId);\n    if (existing) {\n      const newCount = Math.min(existing.count + count, itemDef.stackMax);\n      const added = newCount - existing.count;\n      existing.count = newCount;\n      if (added > 0) {\n        this.game.ui.log(`ğŸ“¦ ${itemDef.icon} ${itemDef.name} +${added}`);\n      }\n    } else {\n      if (this.game.inventory.items.length >= this.game.inventory.slots) {\n        this.game.ui.log(`âš ï¸ èƒŒåŒ…å·²æ»¡ï¼Œ${itemDef.name} ä¸¢å¤±ï¼`);\n        return;\n      }\n      this.game.inventory.items.push({ id: itemId, count: Math.min(count, itemDef.stackMax) });\n      this.game.ui.log(`ğŸ“¦ ${itemDef.icon} ${itemDef.name} +${count}`);\n    }\n  }\n\n  removeItem(itemId: string, count: number = 1): boolean {\n    const idx = this.game.inventory.items.findIndex(i => i.id === itemId);\n    if (idx === -1) return false;\n    this.game.inventory.items[idx].count -= count;\n    if (this.game.inventory.items[idx].count <= 0) {\n      this.game.inventory.items.splice(idx, 1);\n    }\n    return true;\n  }\n\n  getItemCount(itemId: string): number {\n    const item = this.game.inventory.items.find(i => i.id === itemId);\n    return item ? item.count : 0;\n  }\n\n  grantLoot(monsterId: string): void {\n    const lootTable = this.game.config.lootTable[monsterId];\n    if (!lootTable) return;\n    lootTable.forEach(loot => {\n      if (Math.random() < loot.rate) {\n        const count = Math.floor(Math.random() * (loot.maxCount - loot.minCount + 1)) + loot.minCount;\n        this.addItem(loot.itemId, count);\n      }\n    });\n  }\n\n  useItem(index: number): void {\n    const item = this.game.inventory.items[index];\n    if (!item) return;\n    const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === item.id);\n    if (!def || !def.heal) return;\n    const healAmt = Math.min(def.heal, this.game.player.maxHP - this.game.player.hp);\n    if (healAmt <= 0) return;\n    this.game.player.hp += healAmt;\n    this.removeItem(item.id, 1);\n    this.game.ui.log(`ğŸ’š ä½¿ç”¨ ${def.name}ï¼Œæ¢å¤ <span class=\"heal\">${healAmt}</span> HP`);\n    this.game.save();\n    this.game.ui.render();\n    this.game.ui.renderInventoryPanel();\n  }\n\n  useItemInBattle(itemId: string): void {\n    if (!this.game.inBattle) return;\n    const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === itemId);\n    if (!def || !def.heal) return;\n    const healAmt = Math.min(def.heal, this.game.player.maxHP - this.game.player.hp);\n    this.game.player.hp += healAmt;\n    this.removeItem(itemId, 1);\n    this.game.ui.log(`ğŸ’š ä½¿ç”¨ ${def.name}ï¼Œæ¢å¤ <span class=\"heal\">${healAmt}</span> HP`);\n    this.game.ui.showDamagePopup(healAmt, true);\n    document.getElementById('itemModal')?.classList.remove('show');\n    this.game.save();\n    this.game.ui.render();\n    this.game.battle.enemyAttack();\n  }\n\n  smartUseItem(): void {\n    if (!this.game.inBattle) {\n      this.game.ui.log('âŒ éæˆ˜æ–—çŠ¶æ€ï¼');\n      return;\n    }\n    const missingHP = this.game.player.maxHP - this.game.player.hp;\n    if (missingHP < 2) {\n      this.game.ui.log('ğŸ’š æ— éœ€æ¢å¤è¡€é‡ï¼');\n      return;\n    }\n    const hpPercent = this.game.player.hp / this.game.player.maxHP;\n    const consumables = this.game.inventory.items\n      .filter(i => {\n        const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === i.id);\n        return def && def.heal;\n      })\n      .map(i => {\n        const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === i.id);\n        return { ...i, def, heal: def!.heal };\n      })\n      .sort((a, b) => b.heal - a.heal);\n\n    if (consumables.length === 0) {\n      this.game.ui.log('âŒ æ²¡æœ‰å¯ç”¨çš„é“å…·ï¼');\n      return;\n    }\n\n    let selectedItem: { id: string; heal: number } | null = null;\n    if (hpPercent < 0.3) {\n      selectedItem = consumables[0];\n    } else {\n      for (const item of consumables) {\n        if (item.heal >= missingHP * 0.5) {\n          selectedItem = item;\n          break;\n        }\n      }\n      if (!selectedItem) {\n        selectedItem = consumables[consumables.length - 1];\n      }\n    }\n\n    this.useItemInBattle(selectedItem.id);\n  }\n\n  learnScroll(index: number): void {\n    const item = this.game.inventory.items[index];\n    if (!item) return;\n    const def = this.game.config.items.scrolls.find((d: ScrollItem) => d.id === item.id);\n    if (!def || !def.skill) return;\n    if (this.game.player.learnedSkills.includes(def.skill)) return;\n    this.game.player.learnedSkills.push(def.skill);\n    this.removeItem(item.id, 1);\n    const skill = this.game.config.skills.find(s => s.id === def!.skill);\n    this.game.ui.log(`âœ¨ å­¦ä¼šæ–°æŠ€èƒ½ï¼š${skill!.icon} ${skill!.name}ï¼`);\n    this.game.save();\n    this.game.ui.renderInventoryPanel();\n  }\n\n  getUnlockCost(): number {\n    const unlocked = this.game.inventory.slots - this.game.config.inventory.initialSlots;\n    return Math.floor(\n      this.game.config.inventory.unlockCostBase *\n        Math.pow(this.game.config.inventory.unlockCostMultiplier, unlocked)\n    );\n  }\n\n  unlockSlot(): void {\n    if (this.game.inventory.slots >= this.game.config.inventory.maxSlots) return;\n    const cost = this.getUnlockCost();\n    if (this.game.player.gold < cost) {\n      this.game.ui.log('âŒ é‡‘å¸ä¸è¶³ï¼');\n      return;\n    }\n    this.game.player.gold -= cost;\n    this.game.inventory.slots++;\n    this.game.ui.log(`ğŸ”“ èƒŒåŒ…æ‰©å……è‡³ ${this.game.inventory.slots} æ ¼ï¼`);\n    this.game.save();\n    this.game.ui.render();\n    this.game.ui.renderInventoryPanel();\n  }\n\n  canForge(item: Weapon | Armor): boolean {\n    return Object.entries(item.materials).every(([matId, count]) => {\n      return this.getItemCount(matId) >= count;\n    });\n  }\n\n  forgeItem(category: 'weapons' | 'armors', itemId: string): void {\n    const item = this.game.config.equipment[category].find(i => i.id === itemId);\n    if (!item) return;\n    if (!this.canForge(item)) return;\n    Object.entries(item.materials).forEach(([matId, count]) => {\n      this.removeItem(matId, count);\n    });\n    if (category === 'weapons') {\n      this.game.player.weapon = itemId;\n    } else {\n      this.game.player.armor = itemId;\n      const armor = item as Armor;\n      if (armor.maxShield && armor.maxShield > 0) {\n        this.game.player.maxShield = this.game.playerManager.getTotalMaxShield();\n        this.game.player.shield = this.game.player.maxShield;\n      }\n    }\n    this.game.ui.log(`ğŸ”¨ é”»é€ æˆåŠŸï¼š${item.icon} ${item.name}ï¼`);\n    this.game.save();\n    this.game.ui.render();\n    this.game.ui.showForgeCategory(category);\n  }\n}\n","import type { Game } from '../Game';\nimport type { WorldLore, NPC, RandomEvent, StorySaveData } from '../types';\n\ninterface RewardResult {\n  gold: number;\n  exp: number;\n  items: { itemId: string; count: number }[];\n  heal: number;\n  lore: string | null;\n}\n\nexport class StoryManager {\n  private game: Game;\n  private seenLore: Set<string>;\n  private seenNPCs: Set<string>;\n  private triggeredEvents: Set<string>;\n\n  constructor(game: Game) {\n    this.game = game;\n    this.seenLore = new Set();\n    this.seenNPCs = new Set();\n    this.triggeredEvents = new Set();\n  }\n\n  getWorldLore(floor: number): WorldLore {\n    const loreList = this.game.config.worldLore;\n    for (const lore of loreList) {\n      if (floor >= lore.floorRange[0] && floor <= lore.floorRange[1]) {\n        return lore;\n      }\n    }\n    return loreList[0];\n  }\n\n  onFloorAdvance(newFloor: number, _oldFloor: number): { type: string; data: WorldLore; floor: number } | null {\n    const lore = this.getWorldLore(newFloor);\n    const loreKey = `floor_${newFloor}`;\n    const isFirstVisit = !this.seenLore.has(loreKey);\n\n    if (isFirstVisit) {\n      this.seenLore.add(loreKey);\n      return { type: 'lore', data: lore, floor: newFloor };\n    }\n    return null;\n  }\n\n  checkNPC(floor: number): { type: string; data: NPC } | null {\n    const npcs = this.game.config.npcs;\n    const availableNPCs = npcs.filter(\n      npc => floor >= npc.minFloor && !this.seenNPCs.has(`${npc.id}_${floor}`)\n    );\n\n    for (const npc of availableNPCs) {\n      if (Math.random() < npc.probability) {\n        this.seenNPCs.add(`${npc.id}_${floor}`);\n        return { type: 'npc', data: npc };\n      }\n    }\n    return null;\n  }\n\n  checkRandomEvent(floor: number): { type: string; data: RandomEvent } | null {\n    const events = this.game.config.randomEvents;\n    const availableEvents = events.filter(event => floor >= event.minFloor);\n\n    for (const event of availableEvents) {\n      const eventKey = `${event.id}_${Date.now()}`;\n      if (Math.random() < event.probability) {\n        this.triggeredEvents.add(eventKey);\n        return { type: 'event', data: event };\n      }\n    }\n    return null;\n  }\n\n  processEventReward(event: RandomEvent): RewardResult {\n    const reward = event.reward;\n    const outcomes = event.outcomes;\n    const effects = event.effect;\n\n    const result: RewardResult = { gold: 0, exp: 0, items: [], heal: 0, lore: null };\n\n    if (reward) {\n      if (reward.gold) result.gold = reward.gold;\n      if (reward.exp) result.exp = reward.exp;\n      if (reward.itemId) {\n        result.items.push({ itemId: reward.itemId, count: 1 });\n      }\n    }\n\n    if (outcomes && outcomes.length > 0) {\n      const totalWeight = outcomes.reduce((sum, o) => sum + o.weight, 0);\n      let random = Math.random() * totalWeight;\n      for (const outcome of outcomes) {\n        random -= outcome.weight;\n        if (random <= 0) {\n          if (outcome.gold) result.gold = outcome.gold;\n          if (outcome.itemId) {\n            result.items.push({ itemId: outcome.itemId, count: 1 });\n          }\n          break;\n        }\n      }\n    }\n\n    if (effects && effects.length > 0) {\n      const totalWeight = effects.reduce((sum, e) => sum + e.weight, 0);\n      let random = Math.random() * totalWeight;\n      for (const effect of effects) {\n        random -= effect.weight;\n        if (random <= 0) {\n          if (effect.type === 'heal') result.heal = effect.value;\n          if (effect.type === 'gold') result.gold = effect.value;\n          if (effect.type === 'exp') result.exp = effect.value;\n          break;\n        }\n      }\n    }\n\n    if (event.lore) {\n      if (Array.isArray(event.lore)) {\n        result.lore = event.lore[Math.floor(Math.random() * event.lore.length)];\n      } else {\n        result.lore = event.lore;\n      }\n    }\n\n    return result;\n  }\n\n  processNPCReward(npc: NPC): RewardResult {\n    const reward = npc.reward;\n    const result: RewardResult = { gold: 0, exp: 0, items: [], heal: 0, lore: null };\n\n    if (reward) {\n      if (reward.gold) result.gold = reward.gold;\n      if (reward.exp) result.exp = reward.exp;\n      if (reward.itemId) {\n        result.items.push({ itemId: reward.itemId, count: 1 });\n      }\n    }\n\n    return result;\n  }\n\n  applyReward(result: RewardResult): void {\n    if (result.gold && result.gold > 0) {\n      this.game.player.gold += result.gold;\n    }\n    if (result.exp && result.exp > 0) {\n      this.game.player.exp += result.exp;\n      this.game.playerManager.levelUp();\n    }\n    if (result.items && result.items.length > 0) {\n      result.items.forEach(item => {\n        this.game.inventoryManager.addItem(item.itemId, item.count);\n      });\n    }\n    if (result.heal && result.heal > 0) {\n      const actualHeal = Math.min(result.heal, this.game.player.maxHP - this.game.player.hp);\n      this.game.player.hp += actualHeal;\n    }\n  }\n\n  getNPCDialogue(npc: NPC): string {\n    if (npc.dialogues && npc.dialogues.length > 0) {\n      return npc.dialogues[Math.floor(Math.random() * npc.dialogues.length)];\n    }\n    return npc.greeting;\n  }\n\n  hasStoryContent(): boolean {\n    return this.seenLore.size > 0;\n  }\n\n  hasWorldLore(): boolean {\n    return true;\n  }\n\n  hasNPCInteraction(): boolean {\n    return this.seenNPCs.size > 0;\n  }\n\n  reset(): void {\n    this.seenLore.clear();\n    this.seenNPCs.clear();\n    this.triggeredEvents.clear();\n  }\n\n  save(): StorySaveData {\n    return {\n      seenLore: Array.from(this.seenLore),\n      seenNPCs: Array.from(this.seenNPCs),\n      triggeredEvents: Array.from(this.triggeredEvents)\n    };\n  }\n\n  load(data: StorySaveData | undefined): void {\n    if (data) {\n      this.seenLore = new Set(data.seenLore || []);\n      this.seenNPCs = new Set(data.seenNPCs || []);\n    }\n  }\n}\n","import type { Game } from '../Game';\nimport type { MonsterInstance, Skill } from '../types';\n\nexport class BattleManager {\n  private game: Game;\n\n  constructor(game: Game) {\n    this.game = game;\n  }\n\n  isBossFloor(floor: number): boolean {\n    return this.game.config.bossFloors?.includes(floor) ?? false;\n  }\n\n  getBossForFloor(floor: number): MonsterInstance | null {\n    const boss = this.game.config.bosses?.find(b => b.floor === floor);\n    if (!boss) return null;\n    return {\n      id: boss.id,\n      name: boss.name,\n      avatar: boss.avatar,\n      hp: boss.hp,\n      maxHP: boss.hp,\n      atk: boss.atk,\n      def: boss.def,\n      exp: boss.exp,\n      gold: boss.gold,\n      critRate: boss.critRate,\n      dodgeRate: boss.dodgeRate\n    };\n  }\n\n  getPreviousBoss(floor: number): MonsterInstance | null {\n    const bossFloors = this.game.config.bossFloors || [];\n    const prevBossFloor = bossFloors.filter(f => f < floor).pop();\n    if (!prevBossFloor) return null;\n    return this.getBossForFloor(prevBossFloor);\n  }\n\n  createMonster(): MonsterInstance {\n    if (this.isBossFloor(this.game.floor)) {\n      const boss = this.getBossForFloor(this.game.floor);\n      if (boss) {\n        this.game.ui.log(`âš ï¸ BOSS å…³å¡ï¼`);\n        return boss;\n      }\n    }\n\n    const cfg = this.game.config.floor;\n    const monsters = this.game.config.monsters.filter(m => m.minFloor <= this.game.floor);\n    const idx = Math.floor(Math.random() * monsters.length);\n    const m = monsters[idx];\n    \n    let mult = 1 + (this.game.floor - 1) * cfg.difficultyMultiplier;\n    \n    const bossFloors = this.game.config.bossFloors || [];\n    const prevBossFloor = bossFloors.filter(f => f < this.game.floor).pop();\n    if (prevBossFloor) {\n      const nextFloorAfterBoss = prevBossFloor + 1;\n      if (this.game.floor === nextFloorAfterBoss) {\n        const prevBoss = this.getBossForFloor(prevBossFloor);\n        if (prevBoss) {\n          const minHP = prevBoss.maxHP * 0.8;\n          const minAtk = prevBoss.atk * 0.8;\n          const minDef = prevBoss.def * 0.8;\n          \n          mult = Math.max(mult, minHP / m.hp, minAtk / m.atk, minDef / m.def);\n        }\n      }\n    }\n    \n    return {\n      id: m.id,\n      name: m.name,\n      avatar: m.avatar,\n      hp: Math.floor(m.hp * mult),\n      maxHP: Math.floor(m.hp * mult),\n      atk: Math.floor(m.atk * mult),\n      def: Math.floor(m.def * mult),\n      exp: Math.floor(m.exp * mult),\n      gold: Math.floor(m.gold * mult),\n      critRate: m.critRate ?? 0.10,\n      dodgeRate: m.dodgeRate ?? 0.05\n    };\n  }\n\n  explore(): void {\n    if (this.game.inBattle) return;\n    this.game.monster = this.createMonster();\n    this.game.inBattle = true;\n    this.game.slowEffect = 0;\n    this.game.ui.log(`é­é‡äº† ${this.game.monster.avatar} ${this.game.monster.name}ï¼`);\n    this.game.ui.setButtons({ attack: false, skill: false, item: false, inventory: false, next: true });\n    this.game.ui.renderMonster();\n  }\n\n  calcDamage(atk: number, def: number, rand: number): number {\n    return Math.max(1, Math.floor(atk - def + Math.random() * rand));\n  }\n\n  attack(): void {\n    if (!this.game.inBattle) return;\n    const dmg = this.calcDamage(\n      this.game.playerManager.getTotalAtk(),\n      this.game.monster!.def,\n      this.game.config.battle.normalAttackRand\n    );\n    this.dealDamage(dmg, `å¯¹ ${this.game.monster!.name} é€ æˆ `);\n  }\n\n  useSkill(skillId: string): void {\n    if (!this.game.inBattle) return;\n    const skill = this.game.config.skills.find((s: Skill) => s.id === skillId);\n    if (!skill) return;\n    if (this.game.player.skillCooldowns[skillId] > 0) {\n      this.game.ui.log(`â³ ${skill.name} å†·å´ä¸­ï¼è¿˜éœ€ ${this.game.player.skillCooldowns[skillId]} æ¬¡æ”»å‡»`);\n      return;\n    }\n    this.game.player.skillCooldowns[skillId] = skill.cd;\n    this.game.ui.updateSkillName();\n    this.game.ui.showSkillEffect(skill);\n    \n    if (skill.type === 'attack') {\n      const dmg = this.calcDamage(\n        this.game.playerManager.getTotalAtk() * (skill.damageMultiplier ?? 1),\n        this.game.monster!.def,\n        skill.damageRand ?? 0\n      );\n      const msg = `${skill.icon} ${skill.name}ï¼å¯¹ ${this.game.monster!.name} é€ æˆ `;\n      this.dealDamage(dmg, msg, skill);\n    } else if (skill.type === 'heal') {\n      const healAmt = Math.floor(this.game.player.maxHP * (skill.healPercent ?? 0));\n      this.game.player.hp = Math.min(this.game.player.hp + healAmt, this.game.player.maxHP);\n      this.game.ui.log(`${skill.icon} ${skill.name}ï¼æ¢å¤ <span class=\"heal\">${healAmt}</span> HP`);\n      this.game.ui.showDamagePopup(healAmt, true);\n      this.game.player.attackCount = (this.game.player.attackCount || 0) + 1;\n      this.updateSkillCooldowns();\n      this.game.ui.updateSlotStates();\n      this.game.ui.render();\n      this.enemyAttack();\n    }\n  }\n\n  updateSkillCooldowns(): void {\n    Object.keys(this.game.player.skillCooldowns).forEach((skillId: string) => {\n      const cd = this.game.player.skillCooldowns[skillId];\n      if (cd > 0) {\n        this.game.player.skillCooldowns[skillId] = cd - 1;\n      }\n    });\n  }\n\n  useSelectedSkill(): void {\n    const skillId = this.game.player.selectedSkill || this.game.player.learnedSkills[0];\n    if (!skillId) {\n      this.game.ui.log('âŒ æ²¡æœ‰å­¦ä¼šæŠ€èƒ½ï¼');\n      return;\n    }\n    const cd = this.game.player.skillCooldowns[skillId] || 0;\n    if (cd > 0) {\n      const skill = this.game.config.skills.find((s: Skill) => s.id === skillId);\n      this.game.ui.log(`â³ ${skill!.name} å†·å´ä¸­ (${cd}å›åˆ)ï¼`);\n      return;\n    }\n    this.useSkill(skillId);\n  }\n\n  dealDamage(dmg: number, msg: string, skill: Skill | null = null): void {\n    this.game.player.attackCount = (this.game.player.attackCount || 0) + 1;\n    \n    if (!skill) {\n      this.updateSkillCooldowns();\n    }\n\n    const playerCritRate = this.game.player.critRate ?? this.game.config.player.initial.critRate;\n    const monsterDodgeRate = this.game.monster!.dodgeRate ?? 0.05;\n\n    if (Math.random() < monsterDodgeRate) {\n      this.game.ui.log(`${this.game.monster!.avatar} ${this.game.monster!.name} é—ªé¿äº†æ”»å‡»ï¼`);\n      this.game.ui.showDamagePopup(0, false, true);\n      this.game.ui.flashSlot(skill ? 'skill' : 'attack');\n      this.enemyAttack();\n      this.game.ui.updateSlotStates();\n      this.game.ui.render();\n      return;\n    }\n\n    const isCritical = Math.random() < playerCritRate;\n    let finalDmg = dmg;\n    if (isCritical) {\n      finalDmg = Math.floor(dmg * 1.5);\n    }\n\n    this.game.monster!.hp -= finalDmg;\n    const critText = isCritical ? 'ğŸ’¥ æš´å‡»ï¼' : '';\n    this.game.ui.log(`${msg}<span class=\"damage\">${finalDmg}</span> ä¼¤å®³ï¼${critText}`);\n    this.game.ui.flashSlot(skill ? 'skill' : 'attack');\n    this.game.ui.showDamagePopup(finalDmg, false, false, isCritical);\n    this.game.ui.flash('.monster-card');\n    \n    const comboRate = this.game.playerManager.getTotalComboRate();\n    if (comboRate > 0 && Math.random() < comboRate) {\n      const comboDmg = this.performCombo(finalDmg);\n      if (comboDmg > 0) {\n        this.game.monster!.hp -= comboDmg;\n        this.game.ui.log(`âš”ï¸ è¿å‡»ï¼é¢å¤– <span class=\"damage\">${comboDmg}</span> ä¼¤å®³ï¼`);\n        this.game.ui.showDamagePopup(comboDmg, false, false, false, true);\n      }\n    }\n    \n    if (skill && skill.slow) {\n      this.game.slowEffect = skill.slow;\n      this.game.ui.log(`â„ï¸ æ€ªç‰©è¢«å‡é€Ÿï¼`);\n    }\n    if (skill && skill.lifesteal) {\n      const healAmt = Math.floor(finalDmg * skill.lifesteal);\n      this.game.player.hp = Math.min(this.game.player.hp + healAmt, this.game.player.maxHP);\n      this.game.ui.log(`ğŸ©¸ å¸è¡€æ¢å¤ <span class=\"heal\">${healAmt}</span> HP`);\n      this.game.ui.showDamagePopup(healAmt, true);\n    }\n    this.game.ui.renderMonster();\n    if (this.game.monster!.hp <= 0) {\n      this.defeat();\n    } else {\n      this.enemyAttack();\n    }\n    this.game.ui.updateSlotStates();\n    this.game.ui.render();\n  }\n\n  performCombo(baseDamage: number): number {\n    const comboRate = this.game.playerManager.getTotalComboRate();\n    const comboDamage = this.game.playerManager.getTotalComboDamage();\n    let comboCount = 0;\n    let totalDamage = 0;\n    while (Math.random() < comboRate && comboCount < 3) {\n      comboCount++;\n      totalDamage += Math.floor(baseDamage * comboDamage);\n    }\n    return totalDamage;\n  }\n\n  enemyAttack(): void {\n    let atk = this.game.monster!.atk;\n    if (this.game.slowEffect > 0) {\n      atk = Math.floor(atk * (1 - this.game.slowEffect));\n      this.game.slowEffect = Math.max(0, this.game.slowEffect - 0.1);\n    }\n\n    const playerDodgeRate = this.game.player.dodgeRate ?? this.game.config.player.initial.dodgeRate;\n    if (Math.random() < playerDodgeRate) {\n      this.game.ui.log(`ğŸ’« ä½ é—ªé¿äº† ${this.game.monster!.name} çš„æ”»å‡»ï¼`);\n      return;\n    }\n\n    const monsterCritRate = this.game.monster!.critRate ?? 0.10;\n    const isCritical = Math.random() < monsterCritRate;\n\n    let dmg = this.calcDamage(\n      atk,\n      this.game.playerManager.getTotalDef(),\n      this.game.config.battle.enemyAttackRand\n    );\n    if (isCritical) {\n      dmg = Math.floor(dmg * 1.5);\n    }\n\n    const blockRate = this.game.playerManager.getTotalBlockRate();\n    let isBlocked = false;\n    if (blockRate > 0 && Math.random() < blockRate) {\n      const reduction = this.game.playerManager.getTotalBlockReduction();\n      dmg = Math.floor(dmg * (1 - reduction));\n      isBlocked = true;\n    }\n\n    if (this.game.player.shield > 0) {\n      if (this.game.player.shield >= dmg) {\n        this.game.player.shield -= dmg;\n        dmg = 0;\n        this.game.ui.log(`ğŸ›¡ï¸ æŠ¤ç›¾å¸æ”¶äº†æ‰€æœ‰ä¼¤å®³ï¼`);\n      } else {\n        dmg -= this.game.player.shield;\n        this.game.ui.log(`ğŸ›¡ï¸ æŠ¤ç›¾å¸æ”¶äº† ${this.game.player.shield} ä¼¤å®³ï¼`);\n        this.game.player.shield = 0;\n      }\n    }\n\n    if (dmg > 0) {\n      this.game.player.hp -= dmg;\n      const critText = isCritical ? 'ğŸ’¥ æš´å‡»ï¼' : '';\n      const blockText = isBlocked ? 'ğŸ›¡ï¸ æ ¼æŒ¡ï¼' : '';\n      this.game.ui.log(\n        `${this.game.monster!.avatar} ${this.game.monster!.name} å¯¹ä½ é€ æˆ <span class=\"damage\">${dmg}</span> ä¼¤å®³ï¼${critText}${blockText}`\n      );\n      this.game.ui.showPlayerDamagePopup(dmg, isBlocked);\n    }\n    this.game.ui.flash('.status-bar');\n    \n    const counterRate = this.game.playerManager.getTotalCounterRate();\n    if (counterRate > 0 && Math.random() < counterRate && this.game.monster!.hp > 0) {\n      const counterDmg = Math.floor(\n        this.game.playerManager.getTotalAtk() * this.game.playerManager.getTotalCounterDamage()\n      );\n      this.game.monster!.hp -= counterDmg;\n      this.game.ui.log(`âš”ï¸ åå‡»ï¼å¯¹ ${this.game.monster!.name} é€ æˆ <span class=\"damage\">${counterDmg}</span> ä¼¤å®³ï¼`);\n      this.game.ui.showDamagePopup(counterDmg, false, false, false);\n      this.game.ui.renderMonster();\n      \n      if (this.game.monster!.hp <= 0) {\n        this.defeat();\n        return;\n      }\n    }\n    \n    if (this.game.player.hp <= 0) this.game.gameOver();\n  }\n\n  defeat(): void {\n    this.game.inBattle = false;\n    this.game.killed++;\n    this.game.player.exp += this.game.monster!.exp;\n    this.game.player.gold += this.game.monster!.gold;\n    \n    this.game.player.hp = this.game.player.maxHP;\n    const maxShield = this.game.playerManager.getTotalMaxShield();\n    if (maxShield > 0) {\n      this.game.player.shield = maxShield;\n    }\n    \n    this.game.player.attackCount = 0;\n    \n    this.game.ui.log(\n      `ğŸ‰ å‡»è´¥ ${this.game.monster!.name}ï¼+<span class=\"exp\">${this.game.monster!.exp}</span> ç»éªŒ +<span class=\"gold\">${this.game.monster!.gold}</span> é‡‘å¸ ğŸ’š ç”Ÿå‘½æ¢å¤æ»¡`\n    );\n    this.game.inventoryManager.grantLoot(this.game.monster!.id);\n    this.game.playerManager.checkSkillUnlock();\n    this.game.playerManager.levelUp();\n\n    const randomEvent = this.game.storyManager.checkRandomEvent(this.game.floor);\n    if (randomEvent) {\n      const result = this.game.storyManager.processEventReward(randomEvent.data);\n      this.game.storyManager.applyReward(result);\n      setTimeout(() => {\n        this.game.ui.showEventModal(randomEvent.data, result);\n      }, 500);\n    }\n\n    this.game.save();\n    this.game.ui.updatePostBattleUI();\n    \n    if (this.isBossFloor(this.game.floor)) {\n      this.game.canAdvanceFloor = true;\n      this.game.nextFloor();\n    } else {\n      this.game.handleAutoNext();\n    }\n  }\n}\n","import { $ } from '../utils/dom';\nimport type { Game } from '../Game';\nimport type {\n  WorldLore,\n  NPC,\n  RandomEvent,\n  Skill,\n  ConsumableItem,\n  ScrollItem,\n  Weapon,\n  Armor\n} from '../types';\n\ninterface RewardResult {\n  gold: number;\n  exp: number;\n  items: { itemId: string; count: number }[];\n  heal: number;\n  lore: string | null;\n}\n\ninterface ButtonState {\n  attack: boolean;\n  skill: boolean;\n  item: boolean;\n  inventory: boolean;\n  next: boolean;\n}\n\nexport class UIManager {\n  private game: Game;\n\n  constructor(game: Game) {\n    this.game = game;\n  }\n\n  log(msg: string): void {\n    const log = $('battleLog');\n    if (!log) return;\n    const p = document.createElement('p');\n    p.innerHTML = msg;\n    log.appendChild(p);\n    log.scrollTop = log.scrollHeight;\n    const firstChild = log.firstChild;\n    if (log.children.length > 15 && firstChild) {\n      log.removeChild(firstChild);\n    }\n  }\n\n  flash(sel: string): void {\n    const el = document.querySelector(sel);\n    if (!el) return;\n    el.classList.add('shake');\n    setTimeout(() => el.classList.remove('shake'), 300);\n  }\n\n  flashSlot(slotType: 'attack' | 'skill' | 'item'): void {\n    const slotMap = {\n      attack: 'attackSlot',\n      skill: 'skillSlot',\n      item: 'itemSlot'\n    };\n    const slotEl = $(slotMap[slotType]);\n    if (!slotEl) return;\n    slotEl.classList.add('active');\n    setTimeout(() => slotEl.classList.remove('active'), 200);\n  }\n\n  updateSpeedDisplay(): void {\n    const speedText = $('speedText');\n    if (speedText) speedText.textContent = `${this.game.gameSpeed}X`;\n  }\n\n  updateFloorSelectText(): void {\n    const floorSelectText = $('floorSelectText');\n    if (floorSelectText) floorSelectText.textContent = `ç¬¬${this.game.floor}å±‚`;\n  }\n\n  openFloorSelect(): void {\n    const floorList = $('floorList');\n    const modal = $('floorSelectModal');\n    if (!floorList || !modal) return;\n    \n    let html = '';\n    for (let f = 1; f <= this.game.maxFloorReached; f++) {\n      const isBoss = this.game.battle.isBossFloor(f);\n      const isCurrent = f === this.game.floor;\n      const classes = ['floor-item'];\n      if (isBoss) classes.push('boss');\n      if (isCurrent) classes.push('current');\n      \n      html += `<div class=\"${classes.join(' ')}\" data-floor=\"${f}\">\n        <span class=\"num\">${f}</span>\n        <span class=\"icon\">${isBoss ? 'ğŸ‘‘' : ''}</span>\n      </div>`;\n    }\n    \n    floorList.innerHTML = html;\n    \n    floorList.querySelectorAll('.floor-item').forEach(el => {\n      el.addEventListener('click', () => {\n        const floor = parseInt(el.getAttribute('data-floor') || '1');\n        this.game.goToFloor(floor);\n        modal.classList.remove('show');\n      });\n    });\n    \n    modal.classList.add('show');\n  }\n\n  showSkillEffect(skill: Skill): void {\n    const overlay = $('skillEffectOverlay');\n    if (!overlay) return;\n    \n    overlay.setAttribute('data-icon', skill.icon);\n    overlay.className = 'skill-effect-overlay';\n    \n    const effectMap: Record<string, string> = {\n      'powerStrike': 'effect-power',\n      'fireball': 'effect-fire',\n      'frostArrow': 'effect-frost',\n      'thunderStrike': 'effect-thunder',\n      'lifeSteal': 'effect-power',\n      'heal': 'effect-heal'\n    };\n    \n    const effectClass = effectMap[skill.id] || 'effect-power';\n    void overlay.offsetWidth;\n    overlay.classList.add('active', effectClass);\n    \n    setTimeout(() => {\n      overlay.classList.remove('active', effectClass);\n    }, 600);\n  }\n\n  updateSlotStates(): void {\n    const skillSlot = $('skillSlot');\n    const itemSlot = $('itemSlot');\n    const itemSlotCount = $('itemSlotCount');\n    const skillCdOverlay = $('skillCdOverlay');\n    const skillCdProgress = $('skillCdProgress');\n    const skillCdText = $('skillCdText');\n\n    const selectedSkill = this.game.player.selectedSkill || 'powerStrike';\n    const skillCD = this.game.player.skillCooldowns[selectedSkill] ?? 0;\n    const skillDef = this.game.config.skills.find((s: Skill) => s.id === selectedSkill);\n    const maxCD = skillDef?.cd || 3;\n    \n    if (skillSlot) {\n      if (skillCD > 0) {\n        if (skillCdOverlay) {\n          skillCdOverlay.classList.add('visible');\n          if (skillCdProgress) {\n            const remaining = skillCD / maxCD;\n            const circumference = 100.53;\n            skillCdProgress.style.strokeDashoffset = String(circumference * remaining);\n          }\n          if (skillCdText) {\n            skillCdText.textContent = String(skillCD);\n          }\n        }\n      } else {\n        if (skillCdOverlay) skillCdOverlay.classList.remove('visible');\n      }\n    }\n\n    const potionCount = this.game.inventory.items.filter(\n      (i: { id: string }) => i.id === 'healthPotion'\n    ).length;\n    if (itemSlotCount) {\n      itemSlotCount.textContent = String(potionCount);\n    }\n    if (itemSlot) {\n      if (potionCount === 0) {\n        itemSlot.classList.add('disabled');\n      } else {\n        itemSlot.classList.remove('disabled');\n      }\n    }\n  }\n\n  showDamagePopup(\n    value: number,\n    isHeal: boolean,\n    isDodge: boolean = false,\n    isCritical: boolean = false,\n    isCombo: boolean = false,\n    isBlock: boolean = false\n  ): void {\n    const popup = document.createElement('div');\n    let className = 'damage-popup';\n    if (isHeal) className += ' heal-popup';\n    if (isDodge) className += ' dodge-popup';\n    if (isCritical) className += ' critical-popup';\n    if (isCombo) className += ' combo-popup';\n    if (isBlock) className += ' block-popup';\n    popup.className = className;\n\n    if (isDodge) {\n      popup.textContent = 'MISS';\n    } else if (isBlock) {\n      popup.textContent = 'ğŸ›¡ï¸';\n    } else {\n      let prefix = isHeal ? '+' : '-';\n      let suffix = '';\n      if (isCritical) suffix = '!';\n      if (isCombo) suffix += 'âš¡';\n      popup.textContent = prefix + value + suffix;\n    }\n\n    const monsterCard = document.querySelector('.monster-card');\n    if (monsterCard) {\n      const rect = monsterCard.getBoundingClientRect();\n      popup.style.left = rect.left + rect.width / 2 - 20 + Math.random() * 40 + 'px';\n      popup.style.top = rect.top + rect.height / 3 + 'px';\n    }\n    document.body.appendChild(popup);\n    setTimeout(() => popup.remove(), 800);\n  }\n\n  showPlayerDamagePopup(value: number, isBlock: boolean = false): void {\n    const popup = document.createElement('div');\n    let className = 'damage-popup player-damage';\n    if (isBlock) className += ' block-popup';\n    popup.className = className;\n\n    if (isBlock) {\n      popup.textContent = `-${value}ğŸ›¡ï¸`;\n    } else {\n      popup.textContent = `-${value}`;\n    }\n\n    const statusBar = document.querySelector('.status-bar');\n    if (statusBar) {\n      const rect = statusBar.getBoundingClientRect();\n      popup.style.left = rect.left + 20 + Math.random() * 30 + 'px';\n      popup.style.top = rect.top + rect.height / 2 + 'px';\n    }\n    document.body.appendChild(popup);\n    setTimeout(() => popup.remove(), 800);\n  }\n\n  render(): void {\n    const p = this.game.player;\n    const playerLevel = $('playerLevel');\n    const playerHP = $('playerHP');\n    const playerMaxHP = $('playerMaxHP');\n    const playerATK = $('playerATK');\n    const playerDEF = $('playerDEF');\n    const playerEXP = $('playerEXP');\n    const playerMaxEXP = $('playerMaxEXP');\n    const playerGold = $('playerGold');\n    const currentFloor = $('currentFloor');\n    const hpFill = $('hpFill');\n    const expBar = $('expBar');\n    const shieldFill = $('shieldFill');\n    const playerShield = $('playerShield');\n\n    if (playerLevel) playerLevel.textContent = String(p.level);\n    if (playerHP) playerHP.textContent = String(p.hp);\n    if (playerMaxHP) playerMaxHP.textContent = String(p.maxHP);\n    if (playerATK) playerATK.textContent = String(this.game.playerManager.getTotalAtk());\n    if (playerDEF) playerDEF.textContent = String(this.game.playerManager.getTotalDef());\n    if (playerEXP) playerEXP.textContent = String(p.exp);\n    if (playerMaxEXP) playerMaxEXP.textContent = String(p.maxEXP);\n    if (playerGold) playerGold.textContent = String(this.game.player.gold);\n    if (currentFloor) currentFloor.textContent = String(this.game.floor);\n\n    const bossIcon = $('bossIcon');\n    const isBoss = this.game.battle.isBossFloor(this.game.floor);\n    if (bossIcon) {\n      bossIcon.style.display = isBoss ? 'inline' : 'none';\n    }\n    \n    this.updateFloorSelectText();\n    this.updateSpeedDisplay();\n\n    const hpPercent = Math.max(0, (p.hp / p.maxHP) * 100);\n    const expPercent = Math.max(0, (p.exp / p.maxEXP) * 100);\n    if (hpFill) (hpFill as HTMLElement).style.width = `${hpPercent}%`;\n    if (expBar) (expBar as HTMLElement).style.width = `${expPercent}%`;\n\n    const maxShield = this.game.playerManager.getTotalMaxShield();\n    if (shieldFill && maxShield > 0) {\n      const shieldPercent = Math.max(0, (p.shield / maxShield) * 100);\n      (shieldFill as HTMLElement).style.width = `${shieldPercent}%`;\n      (shieldFill as HTMLElement).parentElement!.style.display = 'block';\n    } else if (shieldFill) {\n      (shieldFill as HTMLElement).parentElement!.style.display = 'none';\n    }\n    if (playerShield) {\n      playerShield.textContent = maxShield > 0 ? `${p.shield}/${maxShield}` : '';\n    }\n\n    this.renderSecondaryStats();\n    this.updateSlotStates();\n    this.renderKillProgress();\n    this.renderEquipment();\n  }\n\n  renderSecondaryStats(): void {\n    const comboRate = $('comboRate');\n    const counterRate = $('counterRate');\n    const blockRate = $('blockRate');\n    const secondaryStats = $('secondaryStats');\n\n    const totalCombo = this.game.playerManager.getTotalComboRate();\n    const totalCounter = this.game.playerManager.getTotalCounterRate();\n    const totalBlock = this.game.playerManager.getTotalBlockRate();\n\n    if (comboRate) comboRate.textContent = `${Math.round(totalCombo * 100)}%`;\n    if (counterRate) counterRate.textContent = `${Math.round(totalCounter * 100)}%`;\n    if (blockRate) blockRate.textContent = `${Math.round(totalBlock * 100)}%`;\n\n    const hasSecondaryStats = totalCombo > 0 || totalCounter > 0 || totalBlock > 0;\n    if (secondaryStats) {\n      (secondaryStats as HTMLElement).style.display = hasSecondaryStats ? 'flex' : 'none';\n    }\n  }\n\n  renderKillProgress(): void {\n    const target = this.game.getMonstersToAdvance();\n    const displayKilled = Math.min(this.game.killed, target);\n    const progressEl = $('killProgress');\n    if (!progressEl) return;\n    \n    const isBoss = this.game.battle.isBossFloor(this.game.floor);\n    if (isBoss) {\n      progressEl.textContent = '';\n      progressEl.classList.remove('complete');\n    } else {\n      progressEl.textContent = `${displayKilled}/${target}`;\n      if (this.game.killed >= target) {\n        progressEl.classList.add('complete');\n      } else {\n        progressEl.classList.remove('complete');\n      }\n    }\n  }\n\n  renderEquipment(): void {\n    const weaponEl = $('playerWeapon');\n    const armorEl = $('playerArmor');\n    if (this.game.player.weapon) {\n      const w = this.game.config.equipment.weapons.find((we: Weapon) => we.id === this.game.player.weapon);\n      if (weaponEl) weaponEl.textContent = w ? w.name : 'æ— ';\n    } else {\n      if (weaponEl) weaponEl.textContent = 'æ— ';\n    }\n    if (this.game.player.armor) {\n      const a = this.game.config.equipment.armors.find((ar: Armor) => ar.id === this.game.player.armor);\n      if (armorEl) armorEl.textContent = a ? a.name : 'æ— ';\n    } else {\n      if (armorEl) armorEl.textContent = 'æ— ';\n    }\n  }\n\n  renderMonster(): void {\n    if (!this.game.monster) return;\n    const monsterAvatar = $('monsterAvatar');\n    const monsterName = $('monsterName');\n    const monsterHP = $('monsterHP');\n    const monsterMaxHP = $('monsterMaxHP');\n    const monsterHPFill = $('monsterHPFill');\n    const monsterCard = document.querySelector('.monster-card');\n\n    const isBoss = this.game.battle.isBossFloor(this.game.floor);\n    \n    if (monsterCard) {\n      if (isBoss) {\n        monsterCard.classList.add('boss-monster');\n      } else {\n        monsterCard.classList.remove('boss-monster');\n      }\n    }\n\n    if (monsterAvatar) monsterAvatar.textContent = this.game.monster.avatar;\n    if (monsterName) {\n      monsterName.textContent = isBoss ? `ğŸ‘‘ ${this.game.monster.name}` : this.game.monster.name;\n      if (isBoss) {\n        monsterName.classList.add('boss-name');\n      } else {\n        monsterName.classList.remove('boss-name');\n      }\n    }\n    if (monsterHP) monsterHP.textContent = String(Math.max(0, this.game.monster.hp));\n    if (monsterMaxHP) monsterMaxHP.textContent = String(this.game.monster.maxHP);\n    if (monsterHPFill) {\n      (monsterHPFill as HTMLElement).style.width = `${Math.max(0, (this.game.monster.hp / this.game.monster.maxHP) * 100)}%`;\n      if (isBoss) {\n        monsterHPFill.classList.add('boss-hp');\n      } else {\n        monsterHPFill.classList.remove('boss-hp');\n      }\n    }\n  }\n\n  setButtons({ attack, skill, item, next }: ButtonState): void {\n    const btnAttack = $<HTMLButtonElement>('btnAttack');\n    const btnSkill = $<HTMLButtonElement>('btnSkill');\n    const btnItem = $<HTMLButtonElement>('btnItem');\n    const btnNextFloor = $<HTMLButtonElement>('btnNextFloor');\n\n    if (btnAttack) btnAttack.disabled = attack;\n    if (btnSkill) btnSkill.disabled = skill;\n    if (btnItem) btnItem.disabled = item;\n    if (btnNextFloor) {\n      const shouldDisableNext = next && !this.game.canAdvanceFloor;\n      btnNextFloor.disabled = shouldDisableNext;\n      if (this.game.canAdvanceFloor && !next) {\n        btnNextFloor.classList.add('can-advance');\n      } else {\n        btnNextFloor.classList.remove('can-advance');\n      }\n    }\n  }\n\n  updatePostBattleUI(): void {\n    this.game.canAdvanceFloor = this.game.killed >= this.game.getMonstersToAdvance();\n    this.setButtons({\n      attack: true,\n      skill: true,\n      item: true,\n      inventory: false,\n      next: !this.game.canAdvanceFloor\n    });\n  }\n\n  updateSkillName(): void {\n    const skillId = this.game.player.selectedSkill || this.game.player.learnedSkills[0];\n    const btn = $<HTMLButtonElement>('btnSkill');\n    const currentSkillName = $('currentSkillName');\n    const skillSlotLabel = $('skillSlotLabel');\n    const skillSlotIcon = $('skillSlotIcon');\n\n    if (skillId) {\n      const skill = this.game.config.skills.find((s: Skill) => s.id === skillId);\n      if (skill) {\n        if (skillSlotLabel) skillSlotLabel.textContent = skill.name;\n        if (skillSlotIcon) skillSlotIcon.textContent = skill.icon;\n        \n        const cd = this.game.player.skillCooldowns[skillId] || 0;\n        if (btn && currentSkillName) {\n          if (cd > 0) {\n            currentSkillName.textContent = `${skill.name} (CD:${cd})`;\n            btn.classList.add('on-cooldown');\n          } else {\n            currentSkillName.textContent = skill.name;\n            btn.classList.remove('on-cooldown');\n          }\n        }\n        return;\n      }\n    }\n    if (skillSlotLabel) skillSlotLabel.textContent = 'æ— æŠ€èƒ½';\n    if (skillSlotIcon) skillSlotIcon.textContent = 'âœ¨';\n    if (btn && currentSkillName) {\n      currentSkillName.textContent = 'æ— æŠ€èƒ½';\n      btn.classList.remove('on-cooldown');\n    }\n  }\n\n  showLevelUp(level: number, cfg: { hp: number; atk: number; def: number }): void {\n    const newLevel = $('newLevel');\n    const levelUpHP = $('levelUpHP');\n    const levelUpATK = $('levelUpATK');\n    const levelUpDEF = $('levelUpDEF');\n    const levelUpModal = $('levelUpModal');\n\n    if (newLevel) newLevel.textContent = String(level);\n    if (levelUpHP) levelUpHP.textContent = `+${cfg.hp}`;\n    if (levelUpATK) levelUpATK.textContent = `+${cfg.atk}`;\n    if (levelUpDEF) levelUpDEF.textContent = `+${cfg.def}`;\n    if (levelUpModal) levelUpModal.classList.add('show');\n  }\n\n  closeLevelUpModal(): void {\n    const levelUpModal = $('levelUpModal');\n    if (levelUpModal) levelUpModal.classList.remove('show');\n  }\n\n  openInventory(): void {\n    this.renderInventoryPanel();\n    const inventoryModal = $('inventoryModal');\n    if (inventoryModal) inventoryModal.classList.add('show');\n  }\n\n  renderInventoryPanel(): void {\n    const allItems = [\n      ...this.game.config.items.consumables,\n      ...this.game.config.items.materials,\n      ...this.game.config.items.scrolls\n    ];\n    let html = `<div class=\"inventory-header\">\n      <span>ğŸ’ èƒŒåŒ… (${this.game.inventory.items.length}/${this.game.inventory.slots})</span>`;\n    if (this.game.inventory.slots < this.game.config.inventory.maxSlots) {\n      const cost = this.game.inventoryManager.getUnlockCost();\n      html += `<button class=\"btn-unlock\" onclick=\"game.unlockSlot()\">ğŸ”“ æ‰©å…… (${cost}ğŸ’°)</button>`;\n    }\n    html += '</div><div class=\"inventory-grid\">';\n    this.game.inventory.items.forEach((item, idx) => {\n      const def = allItems.find(d => d.id === item.id);\n      if (!def) return;\n      html += `<div class=\"inv-item\" onclick=\"game.showItemDetail(${idx})\">\n        <span class=\"inv-icon\">${def.icon}</span>\n        <span class=\"inv-name\">${def.name}</span>\n        <span class=\"inv-count\">x${item.count}</span>\n      </div>`;\n    });\n    if (this.game.inventory.items.length === 0) {\n      html += '<p class=\"empty-inv\">èƒŒåŒ…ç©ºç©ºå¦‚ä¹Ÿ</p>';\n    }\n    html += '</div>';\n    const inventoryContent = $('inventoryContent');\n    if (inventoryContent) inventoryContent.innerHTML = html;\n  }\n\n  showItemDetail(index: number): void {\n    const item = this.game.inventory.items[index];\n    if (!item) return;\n    const allItems = [\n      ...this.game.config.items.consumables,\n      ...this.game.config.items.materials,\n      ...this.game.config.items.scrolls\n    ];\n    const def = allItems.find(d => d.id === item.id);\n    if (!def) return;\n    let html = `<div class=\"item-detail\">\n      <h3>${def.icon} ${def.name} x${item.count}</h3>`;\n    const consumableDef = def as ConsumableItem;\n    const scrollDef = def as ScrollItem;\n    if (consumableDef.heal) {\n      html += `<p>æ¢å¤ ${consumableDef.heal} HP</p>`;\n      if (!this.game.inBattle && this.game.player.hp < this.game.player.maxHP) {\n        html += `<button class=\"btn btn-use\" onclick=\"game.useItem(${index})\">ä½¿ç”¨</button>`;\n      } else if (this.game.inBattle) {\n        html += `<p class=\"hint\">æˆ˜æ–—ä¸­æ— æ³•ä½¿ç”¨</p>`;\n      } else {\n        html += `<p class=\"hint\">ç”Ÿå‘½å·²æ»¡</p>`;\n      }\n    } else if (scrollDef.skill) {\n      const skill = this.game.config.skills.find((s: Skill) => s.id === scrollDef.skill);\n      if (skill && this.game.player.learnedSkills.includes(scrollDef.skill)) {\n        html += `<p class=\"hint\">å·²å­¦ä¼š ${skill.name}</p>`;\n      } else if (skill) {\n        html += `<p>å­¦ä¹ æŠ€èƒ½ï¼š${skill.icon} ${skill.name}</p>`;\n        html += `<button class=\"btn btn-use\" onclick=\"game.learnScroll(${index})\">å­¦ä¹ </button>`;\n      }\n    } else {\n      html += `<p class=\"hint\">é”»é€ ææ–™</p>`;\n    }\n    html += '</div>';\n    const inventoryContent = $('inventoryContent');\n    if (inventoryContent) inventoryContent.innerHTML = html;\n  }\n\n  openItemMenu(): void {\n    if (!this.game.inBattle) return;\n    const consumables = this.game.inventory.items.filter(i => {\n      const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === i.id);\n      return def && def.heal;\n    });\n    let html = '';\n    if (consumables.length === 0) {\n      html = '<p class=\"no-items\">æ²¡æœ‰å¯ä½¿ç”¨çš„é“å…·</p>';\n    } else {\n      html = '<div class=\"item-options\">';\n      consumables.forEach(item => {\n        const def = this.game.config.items.consumables.find((d: ConsumableItem) => d.id === item.id);\n        if (def) {\n          html += `<div class=\"item-option\" onclick=\"game.useItemInBattle('${item.id}')\">\n            <span class=\"item-icon\">${def.icon}</span>\n            <span class=\"item-name\">${def.name}</span>\n            <span class=\"item-count\">x${item.count}</span>\n            <span class=\"item-effect\">+${def.heal} HP</span>\n          </div>`;\n        }\n      });\n      html += '</div>';\n    }\n    const itemList = $('itemList');\n    const itemModal = $('itemModal');\n    if (itemList) itemList.innerHTML = html;\n    if (itemModal) itemModal.classList.add('show');\n  }\n\n  openSkillMenu(): void {\n    const learned = this.game.player.learnedSkills;\n    const selectedSkillId = this.game.player.selectedSkill || learned[0];\n    let html = '<div class=\"skill-select-list\">';\n    learned.forEach(skillId => {\n      const skill = this.game.config.skills.find((s: Skill) => s.id === skillId);\n      if (!skill) return;\n      const cd = this.game.player.skillCooldowns[skillId] || 0;\n      const isSelected = skillId === selectedSkillId;\n      html += `<div class=\"skill-select-item ${isSelected ? 'selected' : ''}\">\n        <span class=\"skill-info\">${skill.icon} ${skill.name}${cd > 0 ? ` (${cd})` : ''}</span>\n        <button class=\"btn-small ${isSelected ? 'btn-selected' : ''}\" onclick=\"game.selectSkill('${skillId}')\">${isSelected ? 'å·²é€‰' : 'é€‰æ‹©'}</button>\n      </div>`;\n    });\n    html += '</div>';\n    if (learned.length === 0) {\n      html = '<p style=\"color:#a0a0a0;text-align:center;\">è¿˜æ²¡æœ‰å­¦ä¼šæŠ€èƒ½</p>';\n    }\n    const skillMenuContent = $('skillMenuContent');\n    const skillModal = $('skillModal');\n    if (skillMenuContent) skillMenuContent.innerHTML = html;\n    if (skillModal) skillModal.classList.add('show');\n  }\n\n  openSkillManage(): void {\n    const skillModal = $('skillModal');\n    if (skillModal) skillModal.classList.remove('show');\n    const learned = this.game.player.learnedSkills;\n    const equipped = this.game.player.equippedSkills;\n    const unlocked = this.game.playerManager.getUnlockedSkillSlots();\n    let html = `<p class=\"slot-info\">å·²è§£é” ${unlocked} ä¸ªæŠ€èƒ½æ§½</p>`;\n    html += '<div class=\"skill-manage-grid\">';\n    for (let i = 0; i < 4; i++) {\n      const isUnlocked = i < unlocked;\n      const equippedId = equipped[i];\n      const skill = equippedId ? this.game.config.skills.find((s: Skill) => s.id === equippedId) : null;\n      html += `<div class=\"skill-slot ${isUnlocked ? '' : 'locked'}\">`;\n      if (isUnlocked) {\n        if (skill) {\n          html += `<span>${skill.icon} ${skill.name}</span>`;\n          html += `<button class=\"btn-small\" onclick=\"game.unequipSkill(${i})\">å¸ä¸‹</button>`;\n        } else {\n          html += `<span class=\"empty\">ç©ºæ§½ä½</span>`;\n        }\n      } else {\n        const unlockLevel = this.game.config.player.skillSlots[i];\n        html += `<span class=\"locked\">ğŸ”’ Lv${unlockLevel}è§£é”</span>`;\n      }\n      html += '</div>';\n    }\n    html += '</div>';\n    html += '<h4 style=\"margin: 12px 0 8px; color: var(--accent);\">å·²å­¦æŠ€èƒ½</h4><div class=\"learned-skills\">';\n    learned.forEach(skillId => {\n      if (equipped.includes(skillId)) return;\n      const skill = this.game.config.skills.find((s: Skill) => s.id === skillId);\n      if (!skill) return;\n      html += `<div class=\"skill-item\">\n        <span>${skill.icon} ${skill.name}</span>\n        <button class=\"btn-small\" onclick=\"game.equipSkill('${skillId}')\">è£…å¤‡</button>\n      </div>`;\n    });\n    html += '</div>';\n    const skillManageContent = $('skillManageContent');\n    const skillManageModal = $('skillManageModal');\n    if (skillManageContent) skillManageContent.innerHTML = html;\n    if (skillManageModal) skillManageModal.classList.add('show');\n  }\n\n  openForge(): void {\n    this.renderForgePanel();\n    const forgeModal = $('forgeModal');\n    if (forgeModal) forgeModal.classList.add('show');\n  }\n\n  renderForgePanel(): void {\n    let html = '<div class=\"forge-tabs\">';\n    html += '<button class=\"tab-btn active\" onclick=\"game.showForgeCategory(\\'weapons\\')\">âš”ï¸ æ­¦å™¨</button>';\n    html += '<button class=\"tab-btn\" onclick=\"game.showForgeCategory(\\'armors\\')\">ğŸ›¡ï¸ ç”²èƒ„</button>';\n    html += '</div>';\n    html += '<div id=\"forgeList\"></div>';\n    const forgeContent = $('forgeContent');\n    if (forgeContent) forgeContent.innerHTML = html;\n    this.showForgeCategory('weapons');\n  }\n\n  showForgeCategory(category: 'weapons' | 'armors'): void {\n    document.querySelectorAll('.forge-tabs .tab-btn').forEach((btn, idx) => {\n      btn.classList.toggle('active', (category === 'weapons' && idx === 0) || (category === 'armors' && idx === 1));\n    });\n    const items = this.game.config.equipment[category];\n    const currentEquip = category === 'weapons' ? this.game.player.weapon : this.game.player.armor;\n    let html = '<div class=\"forge-list\">';\n    items.forEach((item: Weapon | Armor) => {\n      const isEquipped = currentEquip === item.id;\n      const canForge = this.game.inventoryManager.canForge(item);\n      html += `<div class=\"forge-item ${isEquipped ? 'equipped' : ''}\">`;\n      html += `<div class=\"forge-info\">\n        <span class=\"forge-icon\">${item.icon}</span>\n        <span class=\"forge-name\">${item.name}</span>\n        <span class=\"forge-stat\">${category === 'weapons' ? `ATK+${(item as Weapon).atk}` : `DEF+${(item as Armor).def}`}</span>\n        ${isEquipped ? '<span class=\"equipped-badge\">å·²è£…å¤‡</span>' : ''}\n      </div>`;\n      html += '<div class=\"forge-mats\">';\n      Object.entries(item.materials).forEach(([matId, count]) => {\n        const mat = this.game.config.items.materials.find(m => m.id === matId);\n        const have = this.game.inventoryManager.getItemCount(matId);\n        const enough = have >= count;\n        html += `<span class=\"mat ${enough ? '' : 'lack'}\">${mat ? mat.icon : '?'} ${have}/${count}</span>`;\n      });\n      html += '</div>';\n      if (isEquipped) {\n        html += `<button class=\"btn btn-unequip\" onclick=\"game.unequipItem('${category}')\">å¸ä¸‹</button>`;\n      } else if (canForge) {\n        html += `<button class=\"btn btn-forge\" onclick=\"game.forgeItem('${category}', '${item.id}')\">é”»é€ </button>`;\n      } else {\n        html += `<button class=\"btn btn-forge disabled\" disabled>ææ–™ä¸è¶³</button>`;\n      }\n      html += '</div>';\n    });\n    html += '</div>';\n    const forgeList = $('forgeList');\n    if (forgeList) forgeList.innerHTML = html;\n  }\n\n  showConfirm(message: string, onConfirm: () => void): void {\n    const confirmMessage = $('confirmMessage');\n    const confirmBtn = $<HTMLButtonElement>('confirmBtn');\n    const confirmModal = $('confirmModal');\n    if (confirmMessage) confirmMessage.textContent = message;\n    if (confirmBtn) {\n      confirmBtn.onclick = () => {\n        this.closeConfirm();\n        onConfirm();\n      };\n    }\n    if (confirmModal) confirmModal.classList.add('show');\n  }\n\n  closeConfirm(): void {\n    const confirmModal = $('confirmModal');\n    if (confirmModal) confirmModal.classList.remove('show');\n  }\n\n  openSettings(): void {\n    const settingsModal = $('settingsModal');\n    if (settingsModal) settingsModal.classList.add('show');\n  }\n\n  closeAllModals(): void {\n    document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));\n  }\n\n  updateBattleBackground(floor: number): void {\n    const lore = this.game.storyManager.getWorldLore(floor);\n    const battleArea = document.querySelector('.battle-area');\n    if (battleArea && lore) {\n      (battleArea as HTMLElement).className = `battle-area ${lore.bgClass}`;\n    }\n  }\n\n  private modalAutoCloseTimer: ReturnType<typeof setTimeout> | null = null;\n\n  private startModalAutoClose(modalId: string, delay: number = 10000): void {\n    this.clearModalAutoClose();\n    this.modalAutoCloseTimer = setTimeout(() => {\n      const modal = $(modalId);\n      if (modal) modal.classList.remove('show');\n    }, delay);\n  }\n\n  private clearModalAutoClose(): void {\n    if (this.modalAutoCloseTimer) {\n      clearTimeout(this.modalAutoCloseTimer);\n      this.modalAutoCloseTimer = null;\n    }\n  }\n\n  showLoreModal(lore: WorldLore, floor: number): void {\n    const loreIcon = $('loreIcon');\n    const loreTitle = $('loreTitle');\n    const loreDescription = $('loreDescription');\n    const loreContent = $('loreContent');\n    const storyModal = $('storyModal');\n\n    if (loreIcon) loreIcon.textContent = lore.icon;\n    if (loreTitle) loreTitle.textContent = `${lore.name} - ç¬¬${floor}å±‚`;\n    if (loreDescription) loreDescription.textContent = lore.description;\n    if (loreContent) loreContent.textContent = lore.lore;\n    if (storyModal) storyModal.classList.add('show');\n    this.startModalAutoClose('storyModal');\n  }\n\n  closeStoryModal(): void {\n    this.clearModalAutoClose();\n    const storyModal = $('storyModal');\n    if (storyModal) storyModal.classList.remove('show');\n  }\n\n  showNPCModal(npc: NPC): void {\n    const npcAvatar = $('npcAvatar');\n    const npcName = $('npcName');\n    const npcGreeting = $('npcGreeting');\n    const npcDialogue = $('npcDialogue');\n    const npcActions = $('npcActions');\n    const npcModal = $('npcModal');\n\n    if (npcAvatar) npcAvatar.textContent = npc.avatar;\n    if (npcName) npcName.textContent = npc.name;\n    if (npcGreeting) npcGreeting.textContent = npc.greeting;\n\n    const dialogue = this.game.storyManager.getNPCDialogue(npc);\n    if (npcDialogue) npcDialogue.textContent = dialogue;\n\n    let actionsHtml = '';\n    if (npc.shop && npc.shop.length > 0) {\n      actionsHtml = '<div class=\"npc-shop\">';\n      npc.shop.forEach(item => {\n        const itemDef =\n          this.game.config.items.consumables.find((i: ConsumableItem) => i.id === item.itemId) ||\n          this.game.config.items.scrolls.find((i: ScrollItem) => i.id === item.itemId);\n        if (itemDef) {\n          const canBuy = this.game.player.gold >= item.price;\n          actionsHtml += `<div class=\"shop-item ${canBuy ? '' : 'disabled'}\" onclick=\"${canBuy ? `game.buyNPCItem('${npc.id}', '${item.itemId}')` : ''}\">\n            <span>${itemDef.icon} ${itemDef.name}</span>\n            <span>${item.price}ğŸ’°</span>\n          </div>`;\n        }\n      });\n      actionsHtml += '</div>';\n    }\n\n    if (npc.reward) {\n      actionsHtml += `<button class=\"btn btn-primary\" onclick=\"game.acceptNPCReward('${npc.id}')\">æ¥å—å¸®åŠ©</button>`;\n    }\n\n    actionsHtml += `<button class=\"btn btn-secondary\" onclick=\"game.closeNPCModal()\">ç¦»å¼€</button>`;\n    if (npcActions) npcActions.innerHTML = actionsHtml;\n    if (npcModal) npcModal.classList.add('show');\n    this.startModalAutoClose('npcModal');\n  }\n\n  closeNPCModal(): void {\n    this.clearModalAutoClose();\n    const npcModal = $('npcModal');\n    if (npcModal) npcModal.classList.remove('show');\n  }\n\n  showEventModal(event: RandomEvent, result: RewardResult): void {\n    const eventIcon = $('eventIcon');\n    const eventName = $('eventName');\n    const eventDescription = $('eventDescription');\n    const eventResult = $('eventResult');\n    const eventModal = $('eventModal');\n\n    if (eventIcon) eventIcon.textContent = event.icon;\n    if (eventName) eventName.textContent = event.name;\n    if (eventDescription) eventDescription.textContent = event.description;\n\n    let resultHtml = '';\n    if (result.lore) {\n      resultHtml += `<p class=\"event-lore\">${result.lore}</p>`;\n    }\n    if (result.gold > 0) {\n      resultHtml += `<p>ğŸ’° è·å¾— ${result.gold} é‡‘å¸</p>`;\n    }\n    if (result.exp > 0) {\n      resultHtml += `<p>â­ è·å¾— ${result.exp} ç»éªŒ</p>`;\n    }\n    if (result.heal > 0) {\n      resultHtml += `<p>ğŸ’š æ¢å¤ ${result.heal} ç”Ÿå‘½</p>`;\n    }\n    if (result.items && result.items.length > 0) {\n      result.items.forEach(item => {\n        const itemDef =\n          this.game.config.items.consumables.find((i: ConsumableItem) => i.id === item.itemId) ||\n          this.game.config.items.scrolls.find((i: ScrollItem) => i.id === item.itemId);\n        if (itemDef) {\n          resultHtml += `<p>ğŸ è·å¾— ${itemDef.icon} ${itemDef.name}</p>`;\n        }\n      });\n    }\n    if (eventResult) eventResult.innerHTML = resultHtml;\n    if (eventModal) eventModal.classList.add('show');\n    this.startModalAutoClose('eventModal');\n  }\n\n  closeEventModal(): void {\n    this.clearModalAutoClose();\n    const eventModal = $('eventModal');\n    if (eventModal) eventModal.classList.remove('show');\n  }\n}\n","import { $ } from './utils/dom';\nimport type { GameConfig, Player, Inventory, MonsterInstance, SaveData, NPC } from './types';\nimport { PlayerManager } from './managers/PlayerManager';\nimport { InventoryManager } from './managers/InventoryManager';\nimport { StoryManager } from './managers/StoryManager';\nimport { BattleManager } from './managers/BattleManager';\nimport { UIManager } from './managers/UIManager';\n\nexport class Game {\n  config: GameConfig;\n  floor: number = 1;\n  killed: number = 0;\n  maxFloorReached: number = 1;\n  monster: MonsterInstance | null = null;\n  inBattle: boolean = false;\n  slowEffect: number = 0;\n  canAdvanceFloor: boolean = false;\n  autoBattleEnabled: boolean = true;\n  autoAdvanceEnabled: boolean = false;\n  autoBattleTimer: ReturnType<typeof setInterval> | null = null;\n  potionStrategy: 'manual' | 'auto30' | 'auto50' | 'battleStart' = 'auto30';\n  gameSpeed: number = 1;\n  player!: Player;\n  inventory!: Inventory;\n\n  ui: UIManager;\n  battle: BattleManager;\n  playerManager: PlayerManager;\n  inventoryManager: InventoryManager;\n  storyManager: StoryManager;\n\n  constructor(config: GameConfig) {\n    this.config = config;\n    this.ui = new UIManager(this);\n    this.battle = new BattleManager(this);\n    this.playerManager = new PlayerManager(this);\n    this.inventoryManager = new InventoryManager(this);\n    this.storyManager = new StoryManager(this);\n  }\n\n  init(): void {\n    this.load();\n    this.bindEvents();\n    this.ui.updateSkillName();\n    this.ui.render();\n    this.startAutoBattle();\n    setTimeout(() => this.explore(), 300);\n  }\n\n  save(): void {\n    const data: SaveData = {\n      player: this.player,\n      floor: this.floor,\n      killed: this.killed,\n      maxFloorReached: this.maxFloorReached,\n      gameSpeed: this.gameSpeed,\n      inventory: this.inventory,\n      story: this.storyManager.save()\n    };\n    localStorage.setItem('loopingEveSave', JSON.stringify(data));\n  }\n\n  load(): void {\n    const saved = localStorage.getItem('loopingEveSave');\n    if (saved) {\n      const data: SaveData = JSON.parse(saved);\n      this.player = data.player;\n      this.floor = data.floor;\n      this.killed = data.killed;\n      this.maxFloorReached = data.maxFloorReached || this.floor;\n      this.gameSpeed = data.gameSpeed || 1;\n      this.inventory = data.inventory || { slots: this.config.inventory.initialSlots, items: [] };\n      this.playerManager.migrateOldData();\n      this.storyManager.load(data.story);\n      this.canAdvanceFloor = this.killed >= this.getMonstersToAdvance();\n    } else {\n      this.playerManager.init();\n      this.inventoryManager.init();\n    }\n  }\n\n  bindEvents(): void {\n    const btnAttack = $('btnAttack');\n    const btnSkill = $('btnSkill');\n    const btnItem = $('btnItem');\n    const btnNextFloor = $('btnNextFloor');\n    const btnSettings = $('btnSettings');\n    const btnClear2 = $('btnClear2');\n    const potionStrategySelect = $('potionStrategy') as HTMLSelectElement;\n    const floorSelectBtn = $('floorSelectBtn');\n    const speedBtn = $('speedBtn');\n\n    if (btnAttack) btnAttack.onclick = () => this.battle.attack();\n    if (btnSkill) btnSkill.onclick = () => this.battle.useSelectedSkill();\n    if (btnItem) btnItem.onclick = () => this.inventoryManager.smartUseItem();\n    if (btnNextFloor) btnNextFloor.onclick = () => this.nextFloor();\n    if (btnSettings) btnSettings.onclick = () => this.ui.openSettings();\n    \n    if (floorSelectBtn) {\n      floorSelectBtn.onclick = () => this.ui.openFloorSelect();\n    }\n    \n    if (speedBtn) {\n      speedBtn.onclick = () => this.cycleSpeed();\n    }\n    \n    if (potionStrategySelect) {\n      potionStrategySelect.value = this.potionStrategy;\n      potionStrategySelect.onchange = () => {\n        this.potionStrategy = potionStrategySelect.value as typeof this.potionStrategy;\n      };\n    }\n    \n    if (btnClear2)\n      btnClear2.onclick = () => {\n        const settingsModal = $('settingsModal');\n        if (settingsModal) settingsModal.classList.remove('show');\n        this.ui.showConfirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¸¢å¤±ï¼', () => this.clearSave());\n      };\n  }\n\n  clearSave(): void {\n    localStorage.removeItem('loopingEveSave');\n    this.playerManager.init();\n    this.inventoryManager.init();\n    this.storyManager.reset();\n    this.floor = 1;\n    this.killed = 0;\n    this.monster = null;\n    this.inBattle = false;\n    this.slowEffect = 0;\n    this.canAdvanceFloor = false;\n    const battleLog = $('battleLog');\n    if (battleLog) battleLog.innerHTML = '<p>å­˜æ¡£å·²æ¸…é™¤ï¼Œç‚¹å‡»ã€Œæ¢ç´¢ã€å¼€å§‹ï¼</p>';\n    this.ui.setButtons({ attack: true, skill: true, item: true, inventory: false, next: true });\n    this.ui.updateBattleBackground(1);\n    this.ui.render();\n    this.ui.closeAllModals();\n  }\n\n  nextFloor(skipLore: boolean = false): void {\n    const oldFloor = this.floor;\n    this.floor++;\n    this.killed = 0;\n    this.maxFloorReached = Math.max(this.maxFloorReached, this.floor);\n    this.ui.log(`ğŸ“ è¿›å…¥ç¬¬ ${this.floor} å±‚ï¼`);\n    const btnNextFloor = $<HTMLButtonElement>('btnNextFloor');\n    if (btnNextFloor) btnNextFloor.disabled = true;\n\n    this.ui.updateBattleBackground(this.floor);\n\n    if (!skipLore) {\n      const loreEvent = this.storyManager.onFloorAdvance(this.floor, oldFloor);\n      if (loreEvent) {\n        this.ui.showLoreModal(loreEvent.data, this.floor);\n      }\n\n      const npcEvent = this.storyManager.checkNPC(this.floor);\n      if (npcEvent) {\n        setTimeout(() => {\n          this.ui.showNPCModal(npcEvent.data);\n        }, loreEvent ? 2000 : 500);\n      }\n    }\n\n    this.save();\n    this.ui.render();\n  }\n\n  getMonstersToAdvance(): number {\n    const base = this.config.floor.monstersToAdvance;\n    const max = this.config.floor.maxMonsters || 10;\n    const floor = this.floor;\n    if (floor <= 5) return base;\n    if (floor <= 10) return Math.min(base + 1, max);\n    if (floor <= 20) return Math.min(base + 2, max);\n    return Math.min(base + 3, max);\n  }\n\n  handleAutoNext(): void {\n    const autoNextEl = $('autoNext') as HTMLInputElement;\n    const autoNext = autoNextEl?.checked ?? false;\n    setTimeout(() => {\n      if (this.canAdvanceFloor && autoNext) {\n        this.nextFloor(true);\n        setTimeout(() => this.battle.explore(), 300);\n      } else {\n        this.battle.explore();\n      }\n    }, 500);\n  }\n\n  gameOver(): void {\n    this.stopAutoBattle();\n    this.stopAutoAdvance();\n    \n    this.floor = Math.max(1, this.floor - 1);\n    this.killed = 0;\n    this.player.hp = this.player.maxHP;\n    this.player.shield = 0;\n    \n    this.ui.log(`ğŸ’€ ä½ è¢«å‡»è´¥äº†ï¼å›é€€åˆ°ç¬¬ ${this.floor} å±‚...`);\n    this.ui.updateBattleBackground(this.floor);\n    \n    this.canAdvanceFloor = false;\n    this.inBattle = false;\n    this.monster = null;\n    \n    this.save();\n    this.ui.render();\n    \n    setTimeout(() => {\n      this.startAutoBattle();\n      this.battle.explore();\n    }, 1000);\n  }\n\n  restart(): void {\n    this.playerManager.init();\n    this.inventoryManager.init();\n    this.storyManager.reset();\n    this.floor = 1;\n    this.killed = 0;\n    this.monster = null;\n    this.inBattle = false;\n    this.slowEffect = 0;\n    localStorage.removeItem('loopingEveSave');\n    const gameOverModal = $('gameOverModal');\n    const battleLog = $('battleLog');\n    if (gameOverModal) gameOverModal.classList.remove('show');\n    if (battleLog) battleLog.innerHTML = '<p>æ¸¸æˆå¼€å§‹ï¼</p>';\n    this.ui.setButtons({ attack: true, skill: true, item: true, inventory: false, next: true });\n    this.ui.updateBattleBackground(1);\n    this.ui.render();\n    setTimeout(() => this.explore(), 500);\n  }\n\n  explore(): void {\n    this.battle.explore();\n  }\n  attack(): void {\n    this.battle.attack();\n  }\n\n  startAutoBattle(): void {\n    if (this.autoBattleTimer) return;\n    this.autoBattleEnabled = true;\n    this.runAutoBattleLoop();\n  }\n\n  stopAutoBattle(): void {\n    this.autoBattleEnabled = false;\n    if (this.autoBattleTimer) {\n      clearTimeout(this.autoBattleTimer);\n      this.autoBattleTimer = null;\n    }\n  }\n\n  stopAutoAdvance(): void {\n    this.autoAdvanceEnabled = false;\n    const autoAdvanceEl = document.getElementById('autoAdvance') as HTMLInputElement;\n    if (autoAdvanceEl) autoAdvanceEl.checked = false;\n  }\n\n  private runAutoBattleLoop(): void {\n    if (!this.autoBattleEnabled) return;\n\n    const baseInterval = this.config.battle.autoBattleInterval || 1000;\n    const interval = baseInterval / this.gameSpeed;\n\n    this.autoBattleTimer = setTimeout(() => {\n      if (!this.autoBattleEnabled) return;\n\n      try {\n        if (this.inBattle && this.monster && this.player) {\n          const skillId = this.player.selectedSkill || 'powerStrike';\n          const skillCD = this.player.skillCooldowns[skillId] ?? 0;\n          \n          if (this.shouldAutoUsePotion()) {\n            this.inventoryManager.smartUseItem();\n            this.ui.flashSlot('item');\n          } else if (skillCD === 0) {\n            this.battle.useSelectedSkill();\n          } else {\n            this.battle.attack();\n          }\n        } else if (!this.inBattle) {\n          this.battle.explore();\n        }\n      } catch (e) {\n        console.warn('Auto battle error:', e);\n      }\n\n      this.runAutoBattleLoop();\n    }, interval);\n  }\n\n  cycleSpeed(): void {\n    const speeds = [1, 2, 3];\n    const currentIndex = speeds.indexOf(this.gameSpeed);\n    this.gameSpeed = speeds[(currentIndex + 1) % speeds.length];\n    this.ui.updateSpeedDisplay();\n  }\n\n  goToFloor(targetFloor: number): void {\n    if (targetFloor > this.maxFloorReached) return;\n    if (targetFloor === this.floor) return;\n    \n    this.floor = targetFloor;\n    this.killed = 0;\n    this.monster = null;\n    this.inBattle = false;\n    this.canAdvanceFloor = false;\n    this.save();\n    this.ui.render();\n    this.ui.updateFloorSelectText();\n  }\n\n  shouldAutoUsePotion(): boolean {\n    if (this.potionStrategy === 'manual') return false;\n    \n    const hasPotion = this.inventory.items.some((i: { id: string }) => i.id === 'healthPotion');\n    if (!hasPotion) return false;\n    \n    if (this.potionStrategy === 'auto30') {\n      return this.player.hp < this.player.maxHP * 0.3;\n    } else if (this.potionStrategy === 'auto50') {\n      return this.player.hp < this.player.maxHP * 0.5;\n    } else if (this.potionStrategy === 'battleStart') {\n      return this.player.hp < this.player.maxHP * 0.9;\n    }\n    return false;\n  }\n\n  useSkill(id: string): void {\n    this.battle.useSkill(id);\n  }\n  useFirstSkill(): void {\n    this.battle.useSelectedSkill();\n  }\n  useItem(idx: number): void {\n    this.inventoryManager.useItem(idx);\n  }\n  useItemInBattle(id: string): void {\n    this.inventoryManager.useItemInBattle(id);\n  }\n  smartUseItem(): void {\n    this.inventoryManager.smartUseItem();\n  }\n  learnScroll(idx: number): void {\n    this.inventoryManager.learnScroll(idx);\n  }\n  unlockSlot(): void {\n    this.inventoryManager.unlockSlot();\n  }\n  openInventory(): void {\n    this.ui.openInventory();\n  }\n  openItemMenu(): void {\n    this.ui.openItemMenu();\n  }\n  openSkillMenu(): void {\n    this.ui.openSkillMenu();\n  }\n  openSkillManage(): void {\n    this.ui.openSkillManage();\n  }\n  openForge(): void {\n    this.ui.openForge();\n  }\n  showForgeCategory(cat: 'weapons' | 'armors'): void {\n    this.ui.showForgeCategory(cat);\n  }\n  forgeItem(cat: 'weapons' | 'armors', id: string): void {\n    this.inventoryManager.forgeItem(cat, id);\n  }\n  unequipItem(cat: 'weapons' | 'armors'): void {\n    this.playerManager.unequipItem(cat);\n    this.save();\n    this.ui.render();\n    this.ui.showForgeCategory(cat);\n    this.ui.log('ğŸ“¤ å·²å¸ä¸‹è£…å¤‡');\n  }\n  equipSkill(id: string): void {\n    const replaced = this.playerManager.equipSkill(id);\n    const skill = this.config.skills.find(s => s.id === id);\n    if (replaced && skill) this.ui.log(`âš ï¸ ${replaced} å·²è¢«æ›¿æ¢ä¸º ${skill.name}`);\n    this.save();\n    this.ui.updateSkillName();\n    this.ui.openSkillManage();\n  }\n  unequipSkill(idx: number): void {\n    this.playerManager.unequipSkill(idx);\n    this.save();\n    this.ui.updateSkillName();\n    this.ui.openSkillManage();\n  }\n  selectSkill(id: string): void {\n    this.player.selectedSkill = id;\n    this.save();\n    this.ui.updateSkillName();\n    this.ui.openSkillMenu();\n  }\n  closeLevelUpModal(): void {\n    this.ui.closeLevelUpModal();\n  }\n  closeStoryModal(): void {\n    this.ui.closeStoryModal();\n  }\n  closeNPCModal(): void {\n    this.ui.closeNPCModal();\n  }\n  closeEventModal(): void {\n    this.ui.closeEventModal();\n  }\n  buyNPCItem(npcId: string, itemId: string): void {\n    const npc = this.config.npcs.find((n: NPC) => n.id === npcId);\n    if (!npc || !npc.shop) return;\n    const shopItem = npc.shop.find(s => s.itemId === itemId);\n    if (!shopItem) return;\n    if (this.player.gold < shopItem.price) {\n      this.ui.log('ğŸ’° é‡‘å¸ä¸è¶³ï¼');\n      return;\n    }\n    this.player.gold -= shopItem.price;\n    this.inventoryManager.addItem(itemId, 1);\n    this.ui.log(`ğŸ’° è´­ä¹°äº†ç‰©å“ï¼`);\n    this.save();\n    this.ui.render();\n  }\n  acceptNPCReward(npcId: string): void {\n    const npc = this.config.npcs.find((n: NPC) => n.id === npcId);\n    if (!npc) return;\n    const result = this.storyManager.processNPCReward(npc);\n    this.storyManager.applyReward(result);\n    this.ui.closeNPCModal();\n    if (result.gold > 0) this.ui.log(`ğŸ’° è·å¾— ${result.gold} é‡‘å¸`);\n    if (result.exp > 0) this.ui.log(`â­ è·å¾— ${result.exp} ç»éªŒ`);\n    if (result.items.length > 0) this.ui.log(`ğŸ è·å¾—ç‰©å“`);\n    this.save();\n    this.ui.render();\n  }\n  showConfirm(msg: string, cb: () => void): void {\n    this.ui.showConfirm(msg, cb);\n  }\n  closeConfirm(): void {\n    this.ui.closeConfirm();\n  }\n  showItemDetail(idx: number): void {\n    this.ui.showItemDetail(idx);\n  }\n}\n\ndeclare global {\n  interface Window {\n    game: Game;\n  }\n}\n","import './style.css';\nimport type { GameConfig } from './types';\nimport { Game } from './Game';\n\nasync function loadConfig(): Promise<GameConfig> {\n  const basePath = import.meta.env.PROD ? './MainGame/dist/' : './';\n  const res = await fetch(basePath + 'Configs/config.json?t=' + Date.now());\n  if (!res.ok) throw new Error('é…ç½®åŠ è½½å¤±è´¥');\n  return res.json();\n}\n\nfunction setupModals(game: Game): void {\n  document.querySelectorAll('.modal').forEach(modal => {\n    modal.addEventListener('click', e => {\n      if (e.target === modal) {\n        if (modal.id === 'gameOverModal') {\n          game.restart();\n        } else {\n          modal.classList.remove('show');\n        }\n      }\n    });\n  });\n}\n\nloadConfig()\n  .then(config => {\n    const game = new Game(config);\n    window.game = game;\n    game.init();\n    setupModals(game);\n  })\n  .catch(e => {\n    alert('é…ç½®åŠ è½½å¤±è´¥ï¼š' + e.message);\n  });\n"],"names":["$","id","PlayerManager","game","atk","weapon","w","def","armor","a","rate","dmg","reduction","shield","level","lvl","cfg","skillId","equipped","unlocked","replacedSkill","oldSkill","s","index","skill","levelMatch","slots","key","category","InventoryManager","itemId","count","itemDef","i","existing","newCount","added","idx","item","monsterId","lootTable","loot","d","healAmt","missingHP","hpPercent","consumables","b","selectedItem","cost","matId","StoryManager","floor","loreList","lore","newFloor","_oldFloor","loreKey","availableNPCs","npc","availableEvents","event","eventKey","reward","outcomes","effects","result","totalWeight","sum","o","random","outcome","e","effect","actualHeal","data","BattleManager","boss","prevBossFloor","f","monsters","m","mult","nextFloorAfterBoss","prevBoss","minHP","minAtk","minDef","rand","msg","cd","playerCritRate","monsterDodgeRate","isCritical","finalDmg","critText","comboRate","comboDmg","baseDamage","comboDamage","comboCount","totalDamage","playerDodgeRate","monsterCritRate","blockRate","isBlocked","blockText","counterRate","counterDmg","maxShield","randomEvent","UIManager","log","p","firstChild","sel","el","slotType","slotEl","speedText","floorSelectText","floorList","modal","html","isBoss","isCurrent","classes","overlay","effectClass","skillSlot","itemSlot","itemSlotCount","skillCdOverlay","skillCdProgress","skillCdText","selectedSkill","skillCD","maxCD","remaining","circumference","potionCount","value","isHeal","isDodge","isCombo","isBlock","popup","className","prefix","suffix","monsterCard","rect","statusBar","playerLevel","playerHP","playerMaxHP","playerATK","playerDEF","playerEXP","playerMaxEXP","playerGold","currentFloor","hpFill","expBar","shieldFill","playerShield","bossIcon","expPercent","shieldPercent","secondaryStats","totalCombo","totalCounter","totalBlock","hasSecondaryStats","target","displayKilled","progressEl","weaponEl","armorEl","we","ar","monsterAvatar","monsterName","monsterHP","monsterMaxHP","monsterHPFill","attack","next","btnAttack","btnSkill","btnItem","btnNextFloor","shouldDisableNext","btn","currentSkillName","skillSlotLabel","skillSlotIcon","newLevel","levelUpHP","levelUpATK","levelUpDEF","levelUpModal","inventoryModal","allItems","inventoryContent","consumableDef","scrollDef","itemList","itemModal","learned","selectedSkillId","isSelected","skillMenuContent","skillModal","isUnlocked","equippedId","unlockLevel","skillManageContent","skillManageModal","forgeModal","forgeContent","items","currentEquip","isEquipped","canForge","mat","have","enough","forgeList","message","onConfirm","confirmMessage","confirmBtn","confirmModal","settingsModal","battleArea","modalId","delay","loreIcon","loreTitle","loreDescription","loreContent","storyModal","npcAvatar","npcName","npcGreeting","npcDialogue","npcActions","npcModal","dialogue","actionsHtml","canBuy","eventIcon","eventName","eventDescription","eventResult","eventModal","resultHtml","Game","config","saved","btnSettings","btnClear2","potionStrategySelect","floorSelectBtn","speedBtn","battleLog","skipLore","oldFloor","loreEvent","npcEvent","base","max","autoNext","gameOverModal","autoAdvanceEl","interval","speeds","currentIndex","targetFloor","cat","replaced","npcId","n","shopItem","cb","loadConfig","res","setupModals"],"mappings":"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"}